Below is the final, complete functional tutorial for ScriptHammer using your original starting commands (without any template flag) and TypeScript. The tutorial is written in Markdown with a clickable table of contents and uses code blocks for terminal commands.

This guide covers everything—from configuring Supabase and setting up your Expo project to creating custom components, setting up Storybook and Jest, and installing required dependencies. A minimal implementation of UserContext is included so that AdminDashboard can import it without errors. In particular, the Chat component has been updated to use Supabase v2’s realtime API (via `supabase.channel(...)`).

> **Important:**  
> - Run the Supabase SQL commands (Section 1) in your Supabase dashboard before starting.  
> - After creating the project, be sure to install the necessary dependency:  
>
>   ```bash
>   npm install @supabase/supabase-js
>   ```  
>
> - When running the provided shell script (Section 8), if your terminal appears to “hang” (waiting for a heredoc closing delimiter), type a new line with exactly:
>
>   ```
>   EOF
>   ```  
>
>   (with no extra spaces) and press Enter.  
> - All terminal commands are provided in code blocks.

---

# Complete Functional Tutorial for ScriptHammer

## Table of Contents

- [1. Supabase Integration & Backend Setup](#1-supabase-integration--backend-setup)
  - [1.1 Authentication and Role Assignment](#11-authentication-and-role-assignment)
  - [1.2 Database Schema and API Service Layer](#12-database-schema-and-api-service-layer)
- [2. Initial Expo Setup & Critical HomeScreen Update](#2-initial-expo-setup--critical-homescreen-update)
  - [2.1 Expo Project Initialization](#21-expo-project-initialization)
  - [2.2 Updating app/index.tsx](#22-updating-appindextsx)
- [3. Building the Admin Dashboard](#3-building-the-admin-dashboard)
- [4. Implementing Social Network Features](#4-implementing-social-network-features)
  - [4.1 Posts Component](#41-posts-component)
  - [4.2 Chat Component](#42-chat-component)
- [5. Developer Experience Tools](#5-developer-experience-tools)
  - [5.1 Storybook Setup](#51-storybook-setup)
  - [5.2 Testing Setup](#52-testing-setup)
- [6. CRUD Scaffolding Interface](#6-crud-scaffolding-interface)
- [7. Additional Context: UserContext](#7-additional-context-usercontext)
- [8. Terminal Setup Script](#8-terminal-setup-script)
- [9. Recommended Folder Structure](#9-recommended-folder-structure)
- [10. Installing Dependencies](#10-installing-dependencies)

---

## 1. Supabase Integration & Backend Setup

### 1.1 Authentication and Role Assignment

Open your Supabase SQL editor and run the following commands:

```sql
-- Create a table for user roles
create table if not exists public.user_roles (
  user_id uuid primary key,
  role text not null,
  created_at timestamp with time zone default now()
);

-- Create a function to assign roles automatically
create or replace function public.assign_role()
returns trigger as $$
declare
  admin_count int;
begin
  select count(*) into admin_count from public.user_roles where role = 'admin';
  if admin_count = 0 then
    insert into public.user_roles(user_id, role) values (new.id, 'admin');
  else
    insert into public.user_roles(user_id, role) values (new.id, 'user');
  end if;
  return new;
end;
$$ language plpgsql;

-- Create the trigger after user insertion
drop trigger if exists assign_role_trigger on auth.users;
create trigger assign_role_trigger
after insert on auth.users
for each row execute function public.assign_role();
```

### 1.2 Database Schema and API Service Layer

Then run these commands in your Supabase SQL editor:

```sql
-- Create posts table
create table if not exists public.posts (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id),
  content text not null,
  created_at timestamp with time zone default now()
);

-- Create chats table
create table if not exists public.chats (
  id uuid primary key default gen_random_uuid(),
  sender_id uuid references auth.users(id),
  receiver_id uuid references auth.users(id),
  message text not null,
  created_at timestamp with time zone default now()
);

-- Create table for CRUD operations
create table if not exists public.crud_items (
  id uuid primary key default gen_random_uuid(),
  content text not null,
  created_at timestamp with time zone default now()
);
```

Next, add these files to your project.

**File: `services/apiService.js`**

```javascript
// services/apiService.js
import { supabase } from './supabaseClient';

// Posts API
export const fetchPosts = async () => {
  const { data, error } = await supabase
    .from('posts')
    .select('*')
    .order('created_at', { ascending: false });
  if (error) {
    console.error('Error fetching posts:', error);
    throw error;
  }
  return data;
};

export const createPost = async (content) => {
  const { data, error } = await supabase
    .from('posts')
    .insert([{ content }]);
  if (error) {
    console.error('Error creating post:', error);
    throw error;
  }
  return data;
};

// Chats API
export const fetchChats = async () => {
  const { data, error } = await supabase
    .from('chats')
    .select('*')
    .order('created_at');
  if (error) {
    console.error('Error fetching chats:', error);
    throw error;
  }
  return data;
};

export const createChatMessage = async (message) => {
  const { data, error } = await supabase
    .from('chats')
    .insert([{ message }]);
  if (error) {
    console.error('Error creating chat message:', error);
    throw error;
  }
  return data;
};
```

**File: `services/supabaseClient.js`**

```javascript
// services/supabaseClient.js
import { createClient } from '@supabase/supabase-js';
import { APP_CONFIG } from '../config/config';

const supabaseUrl = APP_CONFIG.supabaseUrl;
const supabaseAnonKey = APP_CONFIG.supabaseAnonKey;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

---

## 2. Initial Expo Setup & Critical HomeScreen Update

### 2.1 Expo Project Initialization

Run the following commands in your terminal using your original starting commands:

```bash
npx create-expo-app ScriptHammer
cd ScriptHammer
npm run reset-project
rm -rf app-example
```

Then, create the configuration file:

**File: `config/config.js`**

```javascript
// config/config.js
export const APP_CONFIG = {
  projectName: 'ScriptHammer',
  supabaseUrl: process.env.EXPO_PUBLIC_SUPABASE_URL || 'https://wbltsbyjnyraeaqumkcu.supabase.co',
  supabaseAnonKey: process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndibHRzYnlqbnlyYWVhcXVta2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgzNzM1ODksImV4cCI6MjA1Mzk0OTU4OX0.gMqIQ7xIC2zSiwDbbdt6RClZMIkSDQqIJxYzAtdcziY',
};
```

### 2.2 **Critical: Updating app/index.tsx**

Open **app/index.tsx** in your code editor, delete its default contents, and replace them with:

```typescript
// app/index.tsx
import React from 'react';
import { View } from 'react-native';
import PostList from '../components/PostList';
import ChatComponent from '../components/ChatComponent';
import CrudInterface from '../components/CrudInterface';

export default function HomeScreen() {
  return (
    <View style={{ flex: 1, padding: 16 }}>
      <PostList />
      <ChatComponent />
      <CrudInterface />
    </View>
  );
}
```

This critical step ensures that your home screen displays our custom components.

---

## 3. Building the Admin Dashboard

Create the Admin Dashboard component:

**File: `components/AdminDashboard.tsx`**

```typescript
import React, { useContext } from 'react';
import { View, Text, Button } from 'react-native';
import { UserContext } from '../contexts/UserContext';

const AdminDashboard = () => {
  const { role } = useContext(UserContext);

  if (role !== 'admin') {
    return (
      <View style={{ padding: 16 }}>
        <Text style={{ color: 'red', fontSize: 20 }}>Access Denied</Text>
        <Text>You do not have admin privileges.</Text>
      </View>
    );
  }

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>Admin Dashboard</Text>
      <Button title="Refresh Data" onPress={() => { /* Refresh logic here */ }} />
    </View>
  );
};

export default AdminDashboard;
```

Then, create the admin route:

**File: `app/admin/index.tsx`**

```typescript
import React from 'react';
import AdminDashboard from '../../components/AdminDashboard';

export default function AdminScreen() {
  return <AdminDashboard />;
}
```

---

## 4. Implementing Social Network Features

### 4.1 Posts Component

Create the Posts component:

**File: `components/PostList.tsx`**

```typescript
import React, { useEffect, useState } from 'react';
import { View, Text, FlatList, Button } from 'react-native';
import { fetchPosts, createPost } from '../services/apiService';

const PostList = () => {
  const [posts, setPosts] = useState<any[]>([]);

  const loadPosts = async () => {
    try {
      const data = await fetchPosts();
      setPosts(data);
    } catch (error) {
      console.error('Error loading posts:', error);
    }
  };

  useEffect(() => {
    loadPosts();
  }, []);

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>Posts</Text>
      <FlatList
        data={posts}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ marginBottom: 8, padding: 8, borderWidth: 1, borderRadius: 4 }}>
            <Text>{item.content}</Text>
          </View>
        )}
      />
      <Button title="New Post" onPress={() => createPost("Sample post content").then(loadPosts)} />
    </View>
  );
};

export default PostList;
```

### 4.2 Chat Component

Create the Chat component (using Supabase v2’s realtime API):

**File: `components/ChatComponent.tsx`**

```typescript
import React, { useEffect, useState } from 'react';
import { View, Text, FlatList, TextInput, Button } from 'react-native';
import { supabase } from '../services/supabaseClient';
import { createChatMessage, fetchChats } from '../services/apiService';

const ChatComponent = () => {
  const [messages, setMessages] = useState<any[]>([]);
  const [newMessage, setNewMessage] = useState('');

  const loadMessages = async () => {
    try {
      const data = await fetchChats();
      setMessages(data);
    } catch (error) {
      console.error('Error loading messages:', error);
    }
  };

  const sendMessage = async () => {
    if (!newMessage) return;
    try {
      await createChatMessage(newMessage);
      setNewMessage('');
    } catch (error) {
      console.error('Error sending message:', error);
    }
  };

  useEffect(() => {
    loadMessages();

    const channel = supabase
      .channel('realtime-chats')
      .on(
        'postgres_changes',
        { event: 'INSERT', schema: 'public', table: 'chats' },
        (payload) => {
          setMessages((prev) => [...prev, payload.new]);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, []);

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>Chat</Text>
      <FlatList
        data={messages}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ marginBottom: 8, padding: 8, borderWidth: 1, borderRadius: 4 }}>
            <Text>{item.message}</Text>
          </View>
        )}
      />
      <TextInput 
        value={newMessage}
        onChangeText={setNewMessage}
        placeholder="Type your message..."
        style={{ borderWidth: 1, padding: 8, marginBottom: 8 }}
      />
      <Button title="Send" onPress={sendMessage} />
    </View>
  );
};

export default ChatComponent;
```

---

## 5. Developer Experience Tools

### 5.1 Storybook Setup

Create the Storybook configuration:

**File: `.storybook/main.js`**

```javascript
module.exports = {
  stories: ['../components/**/*.stories.@(ts|tsx)'],
  addons: [
    '@storybook/addon-links',
    '@storybook/addon-essentials',
  ],
};
```

Then add a sample story:

**File: `components/Button.stories.tsx`**

```typescript
import React from 'react';
import { Button } from 'react-native';
import { storiesOf } from '@storybook/react-native';

storiesOf('Button', module)
  .add('default', () => (
    <Button title="Click Me" onPress={() => {}} />
  ));
```

### 5.2 Testing Setup

Create the Jest test and configuration files:

**File: `tests/App.test.tsx`**

```typescript
import React from 'react';
import renderer from 'react-test-renderer';
import RootLayout from '../app/_layout';

it('renders correctly', () => {
  const tree = renderer.create(<RootLayout />).toJSON();
  expect(tree).toMatchSnapshot();
});
```

**File: `jest.config.js`**

```javascript
module.exports = {
  preset: 'jest-expo',
  transform: {
    '^.+\\.(js|ts|tsx)$': '<rootDir>/node_modules/react-native/jest/preprocessor.js',
  },
  setupFiles: ['./tests/jest.setup.js'],
};
```

**File: `tests/jest.setup.js`**

```javascript
import 'react-native-gesture-handler/jestSetup';
```

---

## 6. CRUD Scaffolding Interface

Create the CRUD interface component:

**File: `components/CrudInterface.tsx`**

```typescript
import React, { useState, useEffect } from 'react';
import { View, Text, TextInput, Button, FlatList } from 'react-native';
import { supabase } from '../services/supabaseClient';

const CrudInterface = () => {
  const [items, setItems] = useState<any[]>([]);
  const [newItem, setNewItem] = useState('');
  const [editItemId, setEditItemId] = useState<string | null>(null);
  const [editText, setEditText] = useState('');

  const fetchItems = async () => {
    const { data, error } = await supabase
      .from('crud_items')
      .select('*')
      .order('created_at', { ascending: false });
    if (error) {
      console.error('Error fetching items:', error);
    } else {
      setItems(data);
    }
  };

  const createItem = async () => {
    if (!newItem) return;
    const { data, error } = await supabase
      .from('crud_items')
      .insert([{ content: newItem }]);
    if (error) {
      console.error('Error creating item:', error);
    } else {
      setNewItem('');
      fetchItems();
    }
  };

  const updateItem = async () => {
    if (!editText || !editItemId) return;
    const { data, error } = await supabase
      .from('crud_items')
      .update({ content: editText })
      .eq('id', editItemId);
    if (error) {
      console.error('Error updating item:', error);
    } else {
      setEditItemId(null);
      setEditText('');
      fetchItems();
    }
  };

  const deleteItem = async (id: string) => {
    const { data, error } = await supabase
      .from('crud_items')
      .delete()
      .eq('id', id);
    if (error) {
      console.error('Error deleting item:', error);
    } else {
      fetchItems();
    }
  };

  useEffect(() => {
    fetchItems();
  }, []);

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>CRUD Scaffolding Interface</Text>
      <TextInput 
        value={newItem}
        onChangeText={setNewItem}
        placeholder="New item content"
        style={{ borderWidth: 1, padding: 8, marginBottom: 8 }}
      />
      <Button title="Add Item" onPress={createItem} />
      <FlatList
        data={items}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ marginVertical: 8, padding: 8, borderWidth: 1, borderRadius: 4 }}>
            <Text>{item.content}</Text>
            <Button title="Edit" onPress={() => { setEditItemId(item.id); setEditText(item.content); }} />
            <Button title="Delete" onPress={() => deleteItem(item.id)} />
          </View>
        )}
      />
      {editItemId && (
        <View style={{ marginTop: 16 }}>
          <Text>Edit Item</Text>
          <TextInput 
            value={editText}
            onChangeText={setEditText}
            placeholder="Edit item content"
            style={{ borderWidth: 1, padding: 8, marginBottom: 8 }}
          />
          <Button title="Update Item" onPress={updateItem} />
        </View>
      )}
    </View>
  );
};

export default CrudInterface;
```

---

## 7. Additional Context: UserContext

Create a minimal UserContext to resolve the module error in AdminDashboard.

**File: `contexts/UserContext.tsx`**

```typescript
import React, { createContext, useState, ReactNode } from 'react';

type UserContextType = {
  role: string;
  setRole: (role: string) => void;
};

export const UserContext = createContext<UserContextType>({
  role: 'user',
  setRole: () => {},
});

export const UserProvider = ({ children }: { children: ReactNode }) => {
  const [role, setRole] = useState('user');
  return (
    <UserContext.Provider value={{ role, setRole }}>
      {children}
    </UserContext.Provider>
  );
};
```

Then update your root layout to wrap your routes with the UserProvider:

**File: `app/_layout.tsx` (Updated)**

```typescript
import React from 'react';
import { Slot } from 'expo-router';
import { View, Text } from 'react-native';
import { UserProvider } from '../contexts/UserContext';

export default function RootLayout() {
  return (
    <UserProvider>
      <View style={{ flex: 1 }}>
        <Text style={{ padding: 16, fontSize: 24 }}>ScriptHammer</Text>
        <Slot />
      </View>
    </UserProvider>
  );
}
```

---

## 8. Terminal Setup Script

Save the following script as **setup.sh** and run it with:

```bash
bash setup.sh
```

If your terminal waits at a heredoc block, type a new line with exactly `EOF` (with no extra spaces) and press Enter.

```bash
#!/bin/bash
# --- Terminal Setup Script for ScriptHammer (TypeScript Version) ---
# Using your original starting commands (no template flag)

# Step 1: Create and set up the Expo project
npx create-expo-app ScriptHammer
cd ScriptHammer

# Optional: remove leftover example screens
npm run reset-project
rm -rf app-example

# Remove default files so our custom ones overwrite them
rm -f App.tsx
rm -f app/index.tsx
rm -f app/_layout.tsx

# Step 2: Create configuration and Supabase client files
mkdir -p config services components contexts app/tests

cat > config/config.ts <<'EOF'
export const APP_CONFIG = {
  projectName: 'ScriptHammer',
  supabaseUrl: process.env.EXPO_PUBLIC_SUPABASE_URL || 'https://wbltsbyjnyraeaqumkcu.supabase.co',
  supabaseAnonKey: process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndibHRzYnlqbnlyYWVhcXVta2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgzNzM1ODksImV4cCI6MjA1Mzk0OTU4OX0.gMqIQ7xIC2zSiwDbbdt6RClZMIkSDQqIJxYzAtdcziY',
};
EOF

cat > services/supabaseClient.ts <<'EOF'
import { createClient } from '@supabase/supabase-js';
import { APP_CONFIG } from '../config/config';

const supabaseUrl = APP_CONFIG.supabaseUrl;
const supabaseAnonKey = APP_CONFIG.supabaseAnonKey;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
EOF

cat > services/apiService.ts <<'EOF'
import { supabase } from './supabaseClient';

// Posts API
export const fetchPosts = async () => {
  const { data, error } = await supabase.from('posts').select('*').order('created_at', { ascending: false });
  if (error) {
    console.error('Error fetching posts:', error);
    throw error;
  }
  return data;
};

export const createPost = async (content: string) => {
  const { data, error } = await supabase.from('posts').insert([{ content }]);
  if (error) {
    console.error('Error creating post:', error);
    throw error;
  }
  return data;
};

// Chats API
export const fetchChats = async () => {
  const { data, error } = await supabase.from('chats').select('*').order('created_at');
  if (error) {
    console.error('Error fetching chats:', error);
    throw error;
  }
  return data;
};

export const createChatMessage = async (message: string) => {
  const { data, error } = await supabase.from('chats').insert([{ message }]);
  if (error) {
    console.error('Error creating chat message:', error);
    throw error;
  }
  return data;
};
EOF

# Step 3: Create component files
mkdir -p components

cat > components/AdminDashboard.tsx <<'EOF'
import React, { useContext } from 'react';
import { View, Text, Button } from 'react-native';
import { UserContext } from '../contexts/UserContext';

const AdminDashboard = () => {
  const { role } = useContext(UserContext);

  if (role !== 'admin') {
    return (
      <View style={{ padding: 16 }}>
        <Text style={{ color: 'red', fontSize: 20 }}>Access Denied</Text>
        <Text>You do not have admin privileges.</Text>
      </View>
    );
  }

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>Admin Dashboard</Text>
      <Button title="Refresh Data" onPress={() => { /* Refresh logic here */ }} />
    </View>
  );
};

export default AdminDashboard;
EOF

cat > components/PostList.tsx <<'EOF'
import React, { useEffect, useState } from 'react';
import { View, Text, FlatList, Button } from 'react-native';
import { fetchPosts, createPost } from '../services/apiService';

const PostList = () => {
  const [posts, setPosts] = useState<any[]>([]);

  const loadPosts = async () => {
    try {
      const data = await fetchPosts();
      setPosts(data);
    } catch (error) {
      console.error('Error loading posts:', error);
    }
  };

  useEffect(() => {
    loadPosts();
  }, []);

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>Posts</Text>
      <FlatList
        data={posts}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ marginBottom: 8, padding: 8, borderWidth: 1, borderRadius: 4 }}>
            <Text>{item.content}</Text>
          </View>
        )}
      />
      <Button title="New Post" onPress={() => createPost("Sample post content").then(loadPosts)} />
    </View>
  );
};

export default PostList;
EOF

cat > components/ChatComponent.tsx <<'EOF'
import React, { useEffect, useState } from 'react';
import { View, Text, FlatList, TextInput, Button } from 'react-native';
import { supabase } from '../services/supabaseClient';
import { createChatMessage, fetchChats } from '../services/apiService';

const ChatComponent = () => {
  const [messages, setMessages] = useState<any[]>([]);
  const [newMessage, setNewMessage] = useState('');

  const loadMessages = async () => {
    try {
      const data = await fetchChats();
      setMessages(data);
    } catch (error) {
      console.error('Error loading messages:', error);
    }
  };

  const sendMessage = async () => {
    if (!newMessage) return;
    try {
      await createChatMessage(newMessage);
      setNewMessage('');
    } catch (error) {
      console.error('Error sending message:', error);
    }
  };

  useEffect(() => {
    loadMessages();
    const channel = supabase
      .channel('realtime-chats')
      .on(
        'postgres_changes',
        { event: 'INSERT', schema: 'public', table: 'chats' },
        (payload) => {
          setMessages((prev) => [...prev, payload.new]);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, []);

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>Chat</Text>
      <FlatList
        data={messages}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ marginBottom: 8, padding: 8, borderWidth: 1, borderRadius: 4 }}>
            <Text>{item.message}</Text>
          </View>
        )}
      />
      <TextInput 
        value={newMessage}
        onChangeText={setNewMessage}
        placeholder="Type your message..."
        style={{ borderWidth: 1, padding: 8, marginBottom: 8 }}
      />
      <Button title="Send" onPress={sendMessage} />
    </View>
  );
};

export default ChatComponent;
EOF

cat > components/CrudInterface.tsx <<'EOF'
import React, { useState, useEffect } from 'react';
import { View, Text, TextInput, Button, FlatList } from 'react-native';
import { supabase } from '../services/supabaseClient';

const CrudInterface = () => {
  const [items, setItems] = useState<any[]>([]);
  const [newItem, setNewItem] = useState('');
  const [editItemId, setEditItemId] = useState<string | null>(null);
  const [editText, setEditText] = useState('');

  const fetchItems = async () => {
    const { data, error } = await supabase
      .from('crud_items')
      .select('*')
      .order('created_at', { ascending: false });
    if (error) {
      console.error('Error fetching items:', error);
    } else {
      setItems(data);
    }
  };

  const createItem = async () => {
    if (!newItem) return;
    const { data, error } = await supabase
      .from('crud_items')
      .insert([{ content: newItem }]);
    if (error) {
      console.error('Error creating item:', error);
    } else {
      setNewItem('');
      fetchItems();
    }
  };

  const updateItem = async () => {
    if (!editText || !editItemId) return;
    const { data, error } = await supabase
      .from('crud_items')
      .update({ content: editText })
      .eq('id', editItemId);
    if (error) {
      console.error('Error updating item:', error);
    } else {
      setEditItemId(null);
      setEditText('');
      fetchItems();
    }
  };

  const deleteItem = async (id: string) => {
    const { data, error } = await supabase
      .from('crud_items')
      .delete()
      .eq('id', id);
    if (error) {
      console.error('Error deleting item:', error);
    } else {
      fetchItems();
    }
  };

  useEffect(() => {
    fetchItems();
  }, []);

  return (
    <View style={{ padding: 16 }}>
      <Text style={{ fontSize: 24, marginBottom: 16 }}>CRUD Scaffolding Interface</Text>
      <TextInput 
        value={newItem}
        onChangeText={setNewItem}
        placeholder="New item content"
        style={{ borderWidth: 1, padding: 8, marginBottom: 8 }}
      />
      <Button title="Add Item" onPress={createItem} />
      <FlatList
        data={items}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ marginVertical: 8, padding: 8, borderWidth: 1, borderRadius: 4 }}>
            <Text>{item.content}</Text>
            <Button title="Edit" onPress={() => { setEditItemId(item.id); setEditText(item.content); }} />
            <Button title="Delete" onPress={() => deleteItem(item.id)} />
          </View>
        )}
      />
      {editItemId && (
        <View style={{ marginTop: 16 }}>
          <Text>Edit Item</Text>
          <TextInput 
            value={editText}
            onChangeText={setEditText}
            placeholder="Edit item content"
            style={{ borderWidth: 1, padding: 8, marginBottom: 8 }}
          />
          <Button title="Update Item" onPress={updateItem} />
        </View>
      )}
    </View>
  );
};

export default CrudInterface;
EOF

# Step 4: Overwrite Expo Router files in the app folder (TypeScript)
mkdir -p app/admin

cat > app/_layout.tsx <<'EOF'
import React from 'react';
import { Slot } from 'expo-router';
import { View, Text } from 'react-native';
import { UserProvider } from '../contexts/UserContext';

export default function RootLayout() {
  return (
    <UserProvider>
      <View style={{ flex: 1 }}>
        <Text style={{ padding: 16, fontSize: 24 }}>ScriptHammer</Text>
        <Slot />
      </View>
    </UserProvider>
  );
}
EOF

cat > app/index.tsx <<'EOF'
import React from 'react';
import { View } from 'react-native';
import PostList from '../components/PostList';
import ChatComponent from '../components/ChatComponent';
import CrudInterface from '../components/CrudInterface';

export default function HomeScreen() {
  return (
    <View style={{ flex: 1, padding: 16 }}>
      <PostList />
      <ChatComponent />
      <CrudInterface />
    </View>
  );
}
EOF

cat > app/admin/index.tsx <<'EOF'
import React from 'react';
import AdminDashboard from '../../components/AdminDashboard';

export default function AdminScreen() {
  return <AdminDashboard />;
}
EOF

# Step 5: Create UserContext to resolve module errors
mkdir -p contexts

cat > contexts/UserContext.tsx <<'EOF'
import React, { createContext, useState, ReactNode } from 'react';

type UserContextType = {
  role: string;
  setRole: (role: string) => void;
};

export const UserContext = createContext<UserContextType>({
  role: 'user',
  setRole: () => {},
});

export const UserProvider = ({ children }: { children: ReactNode }) => {
  const [role, setRole] = useState('user');
  return (
    <UserContext.Provider value={{ role, setRole }}>
      {children}
    </UserContext.Provider>
  );
};
EOF

# Step 6: Create Storybook and test files
mkdir -p .storybook tests

cat > .storybook/main.js <<'EOF'
module.exports = {
  stories: ['../components/**/*.stories.@(ts|tsx)'],
  addons: [
    '@storybook/addon-links',
    '@storybook/addon-essentials',
  ],
};
EOF

cat > components/Button.stories.tsx <<'EOF'
import React from 'react';
import { Button } from 'react-native';
import { storiesOf } from '@storybook/react-native';

storiesOf('Button', module)
  .add('default', () => (
    <Button title="Click Me" onPress={() => {}} />
  ));
EOF

cat > tests/App.test.tsx <<'EOF'
import React from 'react';
import renderer from 'react-test-renderer';
import RootLayout from '../app/_layout';

it('renders correctly', () => {
  const tree = renderer.create(<RootLayout />).toJSON();
  expect(tree).toMatchSnapshot();
});
EOF

cat > jest.config.js <<'EOF'
module.exports = {
  preset: 'jest-expo',
  transform: {
    '^.+\\.(js|ts|tsx)$': '<rootDir>/node_modules/react-native/jest/preprocessor.js',
  },
  setupFiles: ['./tests/jest.setup.js'],
};
EOF

cat > tests/jest.setup.js <<'EOF'
import 'react-native-gesture-handler/jestSetup';
EOF

# Step 7: Install necessary dependencies
npm install @supabase/supabase-js

# Step 8: Final message and exit
echo "Project setup complete."
echo "IMPORTANT: Run the Supabase SQL commands from Section 1 in your Supabase dashboard."
exit 0
```

---

## 9. Recommended Folder Structure

After running this script, your project should have a structure similar to:

```plaintext
ScriptHammer/
├── app/
│   ├── _layout.tsx            # Custom Root layout (overwritten; wrapped with UserProvider)
│   ├── index.tsx              # Home screen (custom HomeScreen; overwritten)
│   └── admin/
│       └── index.tsx          # Admin dashboard screen (/admin)
├── assets/                   # Static assets (images, fonts, etc.)
├── components/
│   ├── AdminDashboard.tsx
│   ├── ChatComponent.tsx
│   ├── CrudInterface.tsx
│   ├── PostList.tsx
│   └── Button.stories.tsx     # Storybook stories
├── config/
│   └── config.ts              # Global configuration
├── contexts/
│   └── UserContext.tsx        # User context for authentication/roles
├── services/
│   ├── apiService.ts          # API service for Supabase calls
│   └── supabaseClient.ts      # Supabase client initialization
├── .storybook/
│   └── main.js                # Storybook configuration
├── tests/
│   ├── App.test.tsx           # Snapshot test for the root layout
│   └── jest.setup.js          # Jest setup file
├── jest.config.js             # Jest configuration
├── package.json               # Project dependencies and scripts
└── README.md                  # Project documentation
```

---

## 10. Installing Dependencies

After running the script, ensure that you install all necessary dependencies. In this tutorial, the critical dependency is **@supabase/supabase-js**. The script installs it with the following command:

```bash
npm install @supabase/supabase-js
```

If you need to install additional dependencies such as NativeWind, install them using code blocks, for example:

```bash
npm install nativewind
```

Install any other dependencies as needed.

---

### Final Remarks

- This tutorial uses your original starting commands (without any template flag) and overwrites default TypeScript files so that only your custom files remain.
- A minimal **UserContext.tsx** is provided to resolve module errors.
- The Chat component now uses Supabase v2’s realtime API (`supabase.channel(...)`).
- All terminal commands appear in code blocks.
- Each command runs sequentially; if a command requires interactive input, the script will wait.
- If any heredoc block appears to hang, type a new line with exactly `EOF` (no extra spaces) and press Enter.
- Run this script from the directory where you want the **ScriptHammer** project created.

This is the complete, final functional tutorial. If you encounter any specific errors, please share the exact error messages for further debugging. Now go ahead and run it, and happy coding!
