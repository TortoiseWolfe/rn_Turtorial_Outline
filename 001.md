## Table of Contents

- [1. Supabase Backend Setup](#1-supabase-backend-setup)
  - [1.1 SQL Setup in Supabase](#11-sql-setup-in-supabase)
- [2. Initial Setup & Configuration (Expo)](#2-initial-setup--configuration-expo)
  - [2.1 Repository Setup Using Starting Commands](#21-repository-setup-using-starting-commands)
  - [2.2 Environment Variables & Branding Configuration](#22-environment-variables--branding-configuration)
  - [2.3 Critical Home Screen Update](#23-critical-home-screen-update)
  - [2.4 Installing Dependencies](#24-installing-dependencies)
- [3. Client-Side Supabase Integration](#3-client-side-supabase-integration)
  - [3.1 Supabase Client File](#31-supabase-client-file)
  - [3.2 API Service Layer](#32-api-service-layer)
- [4. Building the Admin Dashboard](#4-building-the-admin-dashboard)
- [5. Implementing Social Network Features](#5-implementing-social-network-features)
  - [5.1 Posts & Chats Components](#51-posts--chats-components)
  - [5.2 Real‑Time Updates with Supabase v2](#52-real-time-updates-with-supabase-v2)
  - [5.3 Styling & Theming with NativeWind](#53-styling--theming-with-nativewind)
- [6. Developer Experience Tools](#6-developer-experience-tools)
  - [6.1 Storybook Setup](#61-storybook-setup)
  - [6.2 Testing Setup with Jest](#62-testing-setup-with-jest)
- [7. CRUD Scaffolding Interface](#7-crud-scaffolding-interface)
- [8. Final Scaffolding Script](#8-final-scaffolding-script)

---

## 1. Supabase Backend Setup

### 1.1 SQL Setup in Supabase

In your Supabase SQL Editor, run the following commands to create your backend schema:

```sql
-- Create the "users" table with a default role of 'user'
CREATE TABLE public.users (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  email text UNIQUE NOT NULL,
  role text DEFAULT 'user',
  created_at timestamptz DEFAULT timezone('utc', now())
);

-- Create the "posts" table
CREATE TABLE public.posts (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id uuid REFERENCES public.users(id),
  content text NOT NULL,
  created_at timestamptz DEFAULT timezone('utc', now())
);

-- Create the "chats" table
CREATE TABLE public.chats (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id uuid REFERENCES public.users(id),
  message text NOT NULL,
  created_at timestamptz DEFAULT timezone('utc', now())
);
```

> **Note:** To enforce that the first user is assigned an "admin" role and subsequent users "user," consider adding a trigger function on the `users` table that checks the current user count.

---

## 2. Initial Setup & Configuration (Expo)

### 2.1 Repository Setup Using Starting Commands

Run the following commands exactly as provided to create and prepare your Expo project:

```bash
npx create-expo-app ScriptHammer
cd ScriptHammer
npm run reset-project
rm -rf app-example
```

### 2.2 Environment Variables & Branding Configuration

Configure your Expo global variables by updating **app.config.js** so that your project name and Supabase keys are available in the app:

```javascript
// app.config.js
export default {
  expo: {
    name: "ScriptHammer",
    slug: "ScriptHammer",
    extra: {
      SUPABASE_URL: "https://your-supabase-url.supabase.co",
      SUPABASE_ANON_KEY: "your-supabase-anon-key",
      projectName: "ScriptHammer"
    },
    // Other Expo configurations...
  },
};
```

### 2.3 Critical Home Screen Update

Replace the default home screen in **app/index.tsx** with the following code. This file manages authentication state, displays dynamic branding, and is wrapped in the NativeWind provider for styling:

```typescript
// app/index.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, StyleSheet, SafeAreaView } from 'react-native';
import Constants from 'expo-constants';
import { NativeWindStyleProvider } from 'nativewind';

// The Supabase integration will be added later (see Section 3)
import { supabase } from './supabaseClient';

const App = () => {
  const [user, setUser] = useState<any>(null);
  const [role, setRole] = useState<string>('user');

  useEffect(() => {
    // Get the current session from Supabase (client file will be created in Section 3)
    const session = supabase.auth.session();
    if (session) {
      setUser(session.user);
      setRole(session.user?.role || 'user');
    }

    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
      setUser(session?.user || null);
    });
    return () => {
      authListener?.unsubscribe();
    };
  }, []);

  return (
    <NativeWindStyleProvider>
      <SafeAreaView style={styles.container}>
        <Header />
        <View style={styles.content}>
          {user ? (
            <Text style={styles.welcome}>
              Welcome back, {user.email}! You are logged in as {role}.
            </Text>
          ) : (
            <Text style={styles.welcome}>
              Welcome to {Constants.manifest?.extra?.projectName || 'ScriptHammer'}!
            </Text>
          )}
        </View>
        <Footer />
      </SafeAreaView>
    </NativeWindStyleProvider>
  );
};

const Header = () => (
  <View style={styles.header}>
    <Text style={styles.headerText}>
      {Constants.manifest?.extra?.projectName || 'ScriptHammer'}
    </Text>
  </View>
);

const Footer = () => (
  <View style={styles.footer}>
    <Text style={styles.footerText}>© {new Date().getFullYear()} ScriptHammer</Text>
  </View>
);

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#fff' },
  header: { padding: 16, backgroundColor: '#6200ee' },
  headerText: { color: '#fff', fontSize: 20, fontWeight: '600' },
  content: { flex: 1, padding: 16 },
  welcome: { fontSize: 16, color: '#333' },
  footer: { padding: 16, backgroundColor: '#f2f2f2' },
  footerText: { textAlign: 'center', color: '#666' },
});

export default App;
```

> **Reminder:** Replace the default home screen entirely with the above code and verify that your project builds before moving on.

### 2.4 Installing Dependencies

Install all required dependencies by running these commands:

```bash
# Core dependencies
npm install @supabase/supabase-js nativewind expo-constants

# Initialize Storybook for React Native
npx -p @storybook/cli sb init --type react_native

# Testing dependencies
npm install --save-dev jest @types/jest react-test-renderer
```

Verify installation with:

```bash
npm list --depth=0
```

---

## 3. Client-Side Supabase Integration

Now that your Expo project is set up, add the client-side integration files for Supabase.

### 3.1 Supabase Client File

Create **app/supabaseClient.ts** (if not already created) with the following content:

```typescript
// app/supabaseClient.ts
import { createClient } from '@supabase/supabase-js';
import Constants from 'expo-constants';

const SUPABASE_URL = Constants.manifest?.extra?.SUPABASE_URL as string;
const SUPABASE_ANON_KEY = Constants.manifest?.extra?.SUPABASE_ANON_KEY as string;

export const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
```

### 3.2 API Service Layer

Next, create **app/apiService.ts** to handle API calls:

```typescript
// app/apiService.ts
import { supabase } from './supabaseClient';

export const createPost = async (userId: string, content: string) => {
  const { data, error } = await supabase
    .from('posts')
    .insert([{ user_id: userId, content }]);
  if (error) {
    console.error('Error creating post:', error);
    throw error;
  }
  return data;
};

export const fetchPosts = async () => {
  const { data, error } = await supabase
    .from('posts')
    .select('*')
    .order('created_at', { ascending: false });
  if (error) {
    console.error('Error fetching posts:', error);
    throw error;
  }
  return data;
};
```

---

## 4. Building the Admin Dashboard

Create a protected admin dashboard screen to be rendered (for instance, only for admin users):

**File: `app/components/AdminDashboard.tsx`**

```typescript
// app/components/AdminDashboard.tsx
import React from 'react';
import { View, Text, StyleSheet } from 'react-native';

const AdminDashboard = () => (
  <View style={styles.container}>
    <Text style={styles.title}>Admin Dashboard</Text>
    {/* Additional administrative functionalities go here */}
  </View>
);

const styles = StyleSheet.create({
  container: { padding: 16 },
  title: { fontSize: 24, fontWeight: '700', marginBottom: 16 },
});

export default AdminDashboard;
```

Integrate this screen in your navigation as needed.

---

## 5. Implementing Social Network Features

### 5.1 Posts & Chats Components

Create a component that displays posts and allows users to create new posts.

**File: `app/components/Posts.tsx`**

```typescript
// app/components/Posts.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, FlatList, StyleSheet, Button, TextInput } from 'react-native';
import { createPost, fetchPosts } from '../apiService';
import { useRealtimePosts } from '../realtimeSubscription';

const Posts = ({ userId }: { userId: string }) => {
  const [posts, setPosts] = useState<any[]>([]);
  const [newPost, setNewPost] = useState('');

  useEffect(() => {
    const loadPosts = async () => {
      try {
        const data = await fetchPosts();
        setPosts(data);
      } catch (error) {
        console.error('Error loading posts:', error);
      }
    };
    loadPosts();
  }, []);

  useRealtimePosts((post) => {
    setPosts((prevPosts) => [post, ...prevPosts]);
  });

  const handleCreatePost = async () => {
    if (!newPost.trim()) return;
    try {
      await createPost(userId, newPost);
      setNewPost('');
    } catch (error) {
      console.error('Error creating post:', error);
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Posts</Text>
      <TextInput
        style={styles.input}
        value={newPost}
        onChangeText={setNewPost}
        placeholder="Write a new post..."
      />
      <Button title="Post" onPress={handleCreatePost} />
      <FlatList
        data={posts}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={styles.post}>
            <Text>{item.content}</Text>
          </View>
        )}
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: { padding: 16 },
  title: { fontSize: 20, marginBottom: 8, fontWeight: '600' },
  input: { height: 40, borderColor: '#ccc', borderWidth: 1, marginBottom: 8, paddingHorizontal: 8 },
  post: { padding: 12, borderBottomColor: '#eee', borderBottomWidth: 1 },
});

export default Posts;
```

### 5.2 Real‑Time Updates with Supabase v2

Create a custom hook to subscribe to new posts in real time:

**File: `app/realtimeSubscription.ts`**

```typescript
// app/realtimeSubscription.ts
import { useEffect } from 'react';
import { supabase } from './supabaseClient';

export const useRealtimePosts = (onNewPost: (post: any) => void) => {
  useEffect(() => {
    const channel = supabase.channel('public:posts');
    channel
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'posts' }, (payload) => {
        onNewPost(payload.new);
      })
      .subscribe();

    return () => {
      channel.unsubscribe();
    };
  }, [onNewPost]);
};
```

### 5.3 Styling & Theming with NativeWind

Since your app is wrapped in `NativeWindStyleProvider` (see **app/index.tsx**), all components automatically support system-based dark/light mode. Ensure you follow [NativeWind’s guidelines](https://www.nativewind.dev/) for class naming and responsive design.

---

## 6. Developer Experience Tools

### 6.1 Storybook Setup

Initialize Storybook and add an initial story for your header component:

```bash
npx -p @storybook/cli sb init --type react_native
```

**File: `storybook/stories/Header.stories.tsx`**

```tsx
import React from 'react';
import { View, Text } from 'react-native';
import { ComponentStory, ComponentMeta } from '@storybook/react-native';

const Header = () => (
  <View style={{ padding: 16, backgroundColor: '#6200ee' }}>
    <Text style={{ color: '#fff', fontSize: 20 }}>ScriptHammer</Text>
  </View>
);

export default {
  title: 'Header',
  component: Header,
} as ComponentMeta<typeof Header>;

const Template: ComponentStory<typeof Header> = () => <Header />;

export const Default = Template.bind({});
```

### 6.2 Testing Setup with Jest

Install Jest and create a test file for your app:

```bash
npm install --save-dev jest @types/jest react-test-renderer
```

**File: `tests/App.test.tsx`**

```tsx
// tests/App.test.tsx
import React from 'react';
import renderer from 'react-test-renderer';
import App from '../app/index';

describe('App', () => {
  it('renders correctly', () => {
    const tree = renderer.create(<App />).toJSON();
    expect(tree).toMatchSnapshot();
  });
});
```

Run your tests with:

```bash
npm test
```

---

## 7. CRUD Scaffolding Interface

Create a dynamic CRUD form component that generates fields based on a provided configuration.

**File: `app/components/CrudScaffold.tsx`**

```tsx
// app/components/CrudScaffold.tsx
import React, { useState } from 'react';
import { View, Text, TextInput, Button, StyleSheet } from 'react-native';

interface Field {
  name: string;
  label: string;
  placeholder: string;
}

interface CrudScaffoldProps {
  fields: Field[];
  onSubmit: (formData: Record<string, string>) => void;
}

const CrudScaffold = ({ fields, onSubmit }: CrudScaffoldProps) => {
  const initialFormState = fields.reduce((acc, field) => {
    acc[field.name] = '';
    return acc;
  }, {} as Record<string, string>);

  const [formData, setFormData] = useState<Record<string, string>>(initialFormState);

  const handleChange = (name: string, value: string) => {
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = () => {
    onSubmit(formData);
    setFormData(initialFormState);
  };

  return (
    <View style={styles.container}>
      {fields.map((field) => (
        <View key={field.name} style={styles.fieldContainer}>
          <Text style={styles.label}>{field.label}</Text>
          <TextInput
            style={styles.input}
            placeholder={field.placeholder}
            value={formData[field.name]}
            onChangeText={(value) => handleChange(field.name, value)}
          />
        </View>
      ))}
      <Button title="Submit" onPress={handleSubmit} />
    </View>
  );
};

const styles = StyleSheet.create({
  container: { padding: 16 },
  fieldContainer: { marginBottom: 12 },
  label: { fontSize: 16, marginBottom: 4 },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    padding: 8,
    borderRadius: 4,
  },
});

export default CrudScaffold;
```

---

## 8. Final Scaffolding Script

Below is a complete terminal script that automates the creation of all essential files and folders. Note that now the client-side Supabase files are created after the project (and home screen) is set up.

```bash
#!/bin/bash
# Initialize Expo project and clean up default files
npx create-expo-app ScriptHammer
cd ScriptHammer
npm run reset-project
rm -rf app-example

# Create essential folders
mkdir -p app/components app/tests app/storybook

# Create client-side Supabase integration AFTER project is created

# Create Supabase client file
cat << 'EOF' > app/supabaseClient.ts
import { createClient } from '@supabase/supabase-js';
import Constants from 'expo-constants';

const SUPABASE_URL = Constants.manifest?.extra?.SUPABASE_URL as string;
const SUPABASE_ANON_KEY = Constants.manifest?.extra?.SUPABASE_ANON_KEY as string;

export const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
EOF

# Create API service file
cat << 'EOF' > app/apiService.ts
import { supabase } from './supabaseClient';

export const createPost = async (userId: string, content: string) => {
  const { data, error } = await supabase.from('posts').insert([{ user_id: userId, content }]);
  if (error) {
    console.error('Error creating post:', error);
    throw error;
  }
  return data;
};

export const fetchPosts = async () => {
  const { data, error } = await supabase.from('posts').select('*').order('created_at', { ascending: false });
  if (error) {
    console.error('Error fetching posts:', error);
    throw error;
  }
  return data;
};
EOF

# Create realtime subscription hook
cat << 'EOF' > app/realtimeSubscription.ts
import { useEffect } from 'react';
import { supabase } from './supabaseClient';

export const useRealtimePosts = (onNewPost: (post: any) => void) => {
  useEffect(() => {
    const channel = supabase.channel('public:posts');
    channel.on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'posts' }, (payload) => {
      onNewPost(payload.new);
    }).subscribe();

    return () => {
      channel.unsubscribe();
    };
  }, [onNewPost]);
};
EOF

# Create updated home screen file
cat << 'EOF' > app/index.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, StyleSheet, SafeAreaView } from 'react-native';
import Constants from 'expo-constants';
import { supabase } from './supabaseClient';
import { NativeWindStyleProvider } from 'nativewind';

const App = () => {
  const [user, setUser] = useState<any>(null);
  const [role, setRole] = useState<string>('user');

  useEffect(() => {
    const session = supabase.auth.session();
    if (session) {
      setUser(session.user);
      setRole(session.user?.role || 'user');
    }
    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
      setUser(session?.user || null);
    });
    return () => {
      authListener?.unsubscribe();
    };
  }, []);

  return (
    <NativeWindStyleProvider>
      <SafeAreaView style={styles.container}>
        <Header />
        <View style={styles.content}>
          {user ? (
            <Text style={styles.welcome}>
              Welcome back, {user.email}! You are logged in as {role}.
            </Text>
          ) : (
            <Text style={styles.welcome}>
              Welcome to {Constants.manifest?.extra?.projectName || 'ScriptHammer'}!
            </Text>
          )}
        </View>
        <Footer />
      </SafeAreaView>
    </NativeWindStyleProvider>
  );
};

const Header = () => (
  <View style={styles.header}>
    <Text style={styles.headerText}>{Constants.manifest?.extra?.projectName || 'ScriptHammer'}</Text>
  </View>
);

const Footer = () => (
  <View style={styles.footer}>
    <Text style={styles.footerText}>© {new Date().getFullYear()} ScriptHammer</Text>
  </View>
);

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#fff' },
  header: { padding: 16, backgroundColor: '#6200ee' },
  headerText: { color: '#fff', fontSize: 20, fontWeight: '600' },
  content: { flex: 1, padding: 16 },
  welcome: { fontSize: 16, color: '#333' },
  footer: { padding: 16, backgroundColor: '#f2f2f2' },
  footerText: { textAlign: 'center', color: '#666' },
});

export default App;
EOF

# Create Admin Dashboard component
cat << 'EOF' > app/components/AdminDashboard.tsx
import React from 'react';
import { View, Text, StyleSheet } from 'react-native';

const AdminDashboard = () => (
  <View style={styles.container}>
    <Text style={styles.title}>Admin Dashboard</Text>
  </View>
);

const styles = StyleSheet.create({
  container: { padding: 16 },
  title: { fontSize: 24, fontWeight: '700', marginBottom: 16 },
});

export default AdminDashboard;
EOF

# Create Posts component
cat << 'EOF' > app/components/Posts.tsx
import React, { useEffect, useState } from 'react';
import { View, Text, FlatList, StyleSheet, Button, TextInput } from 'react-native';
import { createPost, fetchPosts } from '../apiService';
import { useRealtimePosts } from '../realtimeSubscription';

const Posts = ({ userId }: { userId: string }) => {
  const [posts, setPosts] = useState<any[]>([]);
  const [newPost, setNewPost] = useState('');
  useEffect(() => {
    const loadPosts = async () => {
      try {
        const data = await fetchPosts();
        setPosts(data);
      } catch (error) {
        console.error('Error loading posts:', error);
      }
    };
    loadPosts();
  }, []);
  useRealtimePosts((post) => {
    setPosts((prevPosts) => [post, ...prevPosts]);
  });
  const handleCreatePost = async () => {
    if (!newPost.trim()) return;
    try {
      await createPost(userId, newPost);
      setNewPost('');
    } catch (error) {
      console.error('Error creating post:', error);
    }
  };
  return (
    <View style={styles.container}>
      <Text style={styles.title}>Posts</Text>
      <TextInput
        style={styles.input}
        value={newPost}
        onChangeText={setNewPost}
        placeholder="Write a new post..."
      />
      <Button title="Post" onPress={handleCreatePost} />
      <FlatList
        data={posts}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={styles.post}>
            <Text>{item.content}</Text>
          </View>
        )}
      />
    </View>
  );
};
const styles = StyleSheet.create({
  container: { padding: 16 },
  title: { fontSize: 20, marginBottom: 8, fontWeight: '600' },
  input: { height: 40, borderColor: '#ccc', borderWidth: 1, marginBottom: 8, paddingHorizontal: 8 },
  post: { padding: 12, borderBottomColor: '#eee', borderBottomWidth: 1 },
});
export default Posts;
EOF

echo "Project structure has been scaffolded successfully."
```

> **Final Reminder:**  
> Maintain your codebase’s integrity by following best practices and incremental, test-driven development as you integrate these files.

---

By following this complete, step‑by‑step tutorial, you now have a robust mobile app framework that starts with your backend SQL setup, then establishes an Expo project with dynamic branding, and finally integrates client-side Supabase functionality—along with an admin dashboard, real‑time social features, developer tools (Storybook and Jest), and a dynamic CRUD scaffolding interface. All client files (including Supabase client and API service) are now created only after the project has been established. Enjoy coding and happy developing!
