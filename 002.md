Below is a complete, end‐to‐end code listing for your MVP Social Media App. This solution covers all core features (authentication, profile management, friends, posts, messaging, notifications, admin moderation, and analytics) with full screen files. Copy the following commands and files into your project. All environment variables are referenced as provided.

---

### Terminal Commands

```bash
# Create a new Expo project called ScriptHammer
npx create-expo-app ScriptHammer

# Enter the project directory
cd ScriptHammer

# Reset the project (your custom command)
npm run reset-project

# Remove the example app folder
rm -rf app-example
```

### Install Dependencies

```bash
npm install zustand nativewind @supabase/supabase-js @react-native-async-storage/async-storage expo-image-picker
```

---

### Folder Structure

Place files according to the following structure:

```
ScriptHammer/
├── supabase_setup.sql
├── src/
│   ├── supabase.ts
│   ├── store.ts
│   └── app/
│       ├── _layout.tsx
│       ├── (auth)/
│       │   ├── login.tsx
│       │   ├── register.tsx
│       │   └── reset-password.tsx
│       ├── (tabs)/
│       │   ├── feed.tsx
│       │   ├── profile.tsx
│       │   ├── friends.tsx
│       │   └── notifications.tsx
│       ├── post/
│       │   └── [id].tsx
│       ├── chat/
│       │   └── [id].tsx
│       └── (admin)/
│           ├── reports.tsx
│           └── analytics.tsx
```

---

### Code Files

#### **File: src/supabase.ts**  
*(Uses environment variables EXPO_PUBLIC_SUPABASE_URL and EXPO_PUBLIC_SUPABASE_ANON_KEY)*

```tsx
import 'react-native-url-polyfill/auto';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { createClient } from '@supabase/supabase-js';

const SUPABASE_URL = process.env.EXPO_PUBLIC_SUPABASE_URL!;
const SUPABASE_ANON_KEY = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
  auth: {
    storage: AsyncStorage,
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: false,
  },
});
```

---

#### **File: src/store.ts**

```tsx
import { create } from 'zustand';
import { Session, User } from '@supabase/supabase-js';

interface AuthState {
  session: Session | null;
  user: User | null;
  setSession: (session: Session | null) => void;
  setUser: (user: User | null) => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  session: null,
  user: null,
  setSession: (session) => set({ session }),
  setUser: (user) => set({ user }),
}));
```

---

#### **File: src/app/_layout.tsx**  
*(Root layout that manages auth state and redirection between (auth) and (tabs))*

```tsx
import { useEffect } from 'react';
import { Stack, SplashScreen, router, useSegments } from 'expo-router';
import { useAuthStore } from '../store';
import { supabase } from '../supabase';

export default function RootLayout() {
  const { session, setSession, setUser } = useAuthStore();
  const segments = useSegments();

  useEffect(() => {
    supabase.auth.getSession().then(({ data }) => {
      setSession(data.session);
      setUser(data.session?.user ?? null);
    });
    const { data: authListener } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session);
      setUser(session?.user ?? null);
    });
    return () => authListener.subscription.unsubscribe();
  }, []);

  useEffect(() => {
    const inAuthGroup = segments[0] === '(auth)';
    if (!session && !inAuthGroup) router.replace('/(auth)/login');
    else if (session && inAuthGroup) router.replace('/(tabs)/feed');
  }, [session, segments]);

  if (session === undefined) return <SplashScreen />;
  return <Stack screenOptions={{ headerShown: false }} />;
}
```

---

#### **File: src/app/(auth)/login.tsx**

```tsx
import { useState } from 'react';
import { View, Text, TextInput, Pressable, Alert } from 'react-native';
import { Link } from 'expo-router';
import { supabase } from '../../supabase';

export default function LoginScreen() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleLogin = async () => {
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) Alert.alert('Login failed', error.message);
  };

  return (
    <View className="flex-1 justify-center p-4 bg-white">
      <Text className="text-2xl font-bold mb-4 text-center">Welcome Back</Text>
      <TextInput
        className="border rounded mb-2 p-2"
        placeholder="Email"
        autoCapitalize="none"
        value={email}
        onChangeText={setEmail}
      />
      <TextInput
        className="border rounded mb-4 p-2"
        placeholder="Password"
        secureTextEntry
        value={password}
        onChangeText={setPassword}
      />
      <Pressable className="bg-blue-600 p-3 rounded" onPress={handleLogin}>
        <Text className="text-center text-white font-semibold">Log In</Text>
      </Pressable>
      <View className="mt-4 flex-row justify-center">
        <Text>Don't have an account?</Text>
        <Link href="/(auth)/register" className="text-blue-600 ml-1">Sign Up</Link>
      </View>
      <View className="mt-2 flex-row justify-center">
        <Link href="/(auth)/reset-password" className="text-blue-600">Forgot Password?</Link>
      </View>
    </View>
  );
}
```

---

#### **File: src/app/(auth)/register.tsx**

```tsx
import { useState } from 'react';
import { View, Text, TextInput, Pressable, Alert } from 'react-native';
import { Link } from 'expo-router';
import { supabase } from '../../supabase';

export default function RegisterScreen() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [name, setName] = useState('');

  const handleSignUp = async () => {
    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: { data: { full_name: name } },
    });
    if (error) Alert.alert('Registration failed', error.message);
    else Alert.alert('Success', 'Check your email for a confirmation link!');
  };

  return (
    <View className="flex-1 justify-center p-4 bg-white">
      <Text className="text-2xl font-bold mb-4 text-center">Create an Account</Text>
      <TextInput
        className="border rounded mb-2 p-2"
        placeholder="Name"
        value={name}
        onChangeText={setName}
      />
      <TextInput
        className="border rounded mb-2 p-2"
        placeholder="Email"
        autoCapitalize="none"
        value={email}
        onChangeText={setEmail}
      />
      <TextInput
        className="border rounded mb-4 p-2"
        placeholder="Password"
        secureTextEntry
        value={password}
        onChangeText={setPassword}
      />
      <Pressable className="bg-blue-600 p-3 rounded mb-2" onPress={handleSignUp}>
        <Text className="text-center text-white font-semibold">Sign Up</Text>
      </Pressable>
      <Link href="/(auth)/login" className="text-center text-blue-600">
        Already have an account? Log In
      </Link>
    </View>
  );
}
```

---

#### **File: src/app/(auth)/reset-password.tsx**

```tsx
import { useState } from 'react';
import { View, Text, TextInput, Pressable, Alert } from 'react-native';
import { supabase } from '../../supabase';

export default function ResetPasswordScreen() {
  const [email, setEmail] = useState('');

  const handleReset = async () => {
    const { error } = await supabase.auth.resetPasswordForEmail(email, {
      redirectTo: 'myapp://reset-complete',
    });
    if (error) Alert.alert('Error', error.message);
    else Alert.alert('Password Reset', 'Check your email for reset instructions.');
  };

  return (
    <View className="flex-1 justify-center p-4 bg-white">
      <Text className="text-xl mb-4 text-center">Reset Password</Text>
      <TextInput
        className="border rounded mb-4 p-2"
        placeholder="Your account email"
        autoCapitalize="none"
        value={email}
        onChangeText={setEmail}
      />
      <Pressable className="bg-blue-600 p-3 rounded" onPress={handleReset}>
        <Text className="text-center text-white font-semibold">Send Reset Link</Text>
      </Pressable>
    </View>
  );
}
```

---

#### **File: src/app/(tabs)/feed.tsx**

```tsx
import { useState, useEffect } from 'react';
import { View, Text, TextInput, Image, FlatList, Pressable, Alert } from 'react-native';
import * as ImagePicker from 'expo-image-picker';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';

interface Post {
  id: string;
  user_id: string;
  content: string;
  image_url: string | null;
  created_at: string;
  user_name?: string;
  user_avatar?: string;
}

export default function FeedScreen() {
  const { user } = useAuthStore();
  const [posts, setPosts] = useState<Post[]>([]);
  const [content, setContent] = useState('');
  const [image, setImage] = useState<{ uri: string; ext: string } | null>(null);
  const [uploading, setUploading] = useState(false);

  useEffect(() => {
    if (!user) return;
    const loadFeed = async () => {
      let friendIds: string[] = [user.id];
      const { data: friendsData } = await supabase.from('friends')
        .select('user_id_1, user_id_2')
        .eq('status', 'accepted')
        .or(`user_id_1.eq.${user.id},user_id_2.eq.${user.id}`);
      if (friendsData) {
        friendsData.forEach(rel => {
          if (rel.user_id_1 === user.id) friendIds.push(rel.user_id_2);
          if (rel.user_id_2 === user.id) friendIds.push(rel.user_id_1);
        });
      }
      friendIds = Array.from(new Set(friendIds));
      const { data: postsData, error } = await supabase.from('posts')
        .select('id, user_id, content, image_url, created_at')
        .in('user_id', friendIds)
        .order('created_at', { ascending: false });
      if (!error && postsData) {
        const userIds = Array.from(new Set(postsData.map(p => p.user_id)));
        const { data: profiles } = await supabase.from('profiles')
          .select('id, full_name, avatar_url')
          .in('id', userIds);
        const postsWithUser = postsData.map(post => {
          const author = profiles?.find(p => p.id === post.user_id);
          return {
            ...post,
            user_name: author?.full_name || 'Unknown',
            user_avatar: author?.avatar_url || null,
          };
        });
        setPosts(postsWithUser);
      }
    };
    loadFeed();
  }, [user]);

  const pickImage = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({ mediaTypes: ImagePicker.MediaTypeOptions.Images });
    if (!result.canceled && result.assets.length > 0) {
      const asset = result.assets[0];
      const ext = asset.uri.split('.').pop() || 'jpg';
      setImage({ uri: asset.uri, ext });
    }
  };

  const submitPost = async () => {
    if (!user) return;
    setUploading(true);
    let image_url: string | null = null;
    try {
      if (image) {
        const filePath = `${user.id}/${Date.now()}.${image.ext}`;
        const { error: uploadError } = await supabase.storage.from('posts').upload(filePath, {
          uri: image.uri,
          name: filePath,
          type: `image/${image.ext}`,
        });
        if (uploadError) throw uploadError;
        const { data: publicURL } = supabase.storage.from('posts').getPublicUrl(filePath);
        image_url = publicURL.publicUrl;
      }
      const { error } = await supabase.from('posts').insert({
        user_id: user.id,
        content,
        image_url,
      });
      if (error) throw error;
      const newPost: Post = {
        id: crypto.randomUUID(),
        user_id: user.id,
        content,
        image_url,
        created_at: new Date().toISOString(),
        user_name: 'You',
        user_avatar: null,
      };
      setPosts([newPost, ...posts]);
      setContent('');
      setImage(null);
      Alert.alert('Posted!', 'Your post has been shared.');
    } catch (err: any) {
      Alert.alert('Post failed', err.message);
    } finally {
      setUploading(false);
    }
  };

  const renderPost = ({ item }: { item: Post }) => (
    <Pressable onPress={() => { /* Navigate to post detail */ }} className="mb-4 p-3 bg-white rounded shadow">
      <View className="flex-row items-center mb-2">
        {item.user_avatar ? (
          <Image source={{ uri: item.user_avatar }} className="h-8 w-8 rounded-full mr-2" />
        ) : (
          <View className="h-8 w-8 rounded-full mr-2 bg-gray-400" />
        )}
        <Text className="font-semibold">{item.user_name}</Text>
      </View>
      {item.content ? <Text className="mb-2">{item.content}</Text> : null}
      {item.image_url ? <Image source={{ uri: item.image_url }} className="w-full h-48 rounded" /> : null}
    </Pressable>
  );

  return (
    <View className="flex-1 p-4 bg-gray-100">
      <View className="bg-white p-3 mb-4 rounded shadow">
        <TextInput
          className="border border-gray-300 rounded p-2 mb-2"
          placeholder="What's on your mind?"
          value={content}
          onChangeText={setContent}
          multiline
        />
        {image && <Image source={{ uri: image.uri }} className="h-32 w-full object-cover mb-2" />}
        <View className="flex-row justify-between">
          <Pressable onPress={pickImage} className="py-2 px-3 bg-gray-200 rounded">
            <Text>Add Photo</Text>
          </Pressable>
          <Pressable onPress={submitPost} className="py-2 px-4 bg-blue-600 rounded">
            <Text className="text-white font-semibold">{uploading ? 'Posting...' : 'Post'}</Text>
          </Pressable>
        </View>
      </View>
      <FlatList
        data={posts}
        keyExtractor={(item) => item.id}
        renderItem={renderPost}
        ListEmptyComponent={<Text>No posts yet. Add friends to see their posts!</Text>}
      />
    </View>
  );
}
```

---

#### **File: src/app/(tabs)/profile.tsx**  
*(User Profile Management)*

```tsx
import { useState, useEffect } from 'react';
import { View, Text, TextInput, Image, Pressable, Alert } from 'react-native';
import * as ImagePicker from 'expo-image-picker';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';

export default function ProfileScreen() {
  const { user } = useAuthStore();
  const [profile, setProfile] = useState({ full_name: '', bio: '', avatar_url: '', privacy: 'public' });
  const [uploading, setUploading] = useState(false);

  useEffect(() => {
    if (!user) return;
    supabase.from('profiles')
      .select('full_name, bio, avatar_url, privacy')
      .eq('id', user.id)
      .single()
      .then(({ data, error }) => {
        if (!error && data) setProfile(data);
      });
  }, [user]);

  const updateProfile = async () => {
    if (!user) return;
    const { error } = await supabase.from('profiles').update({
      full_name: profile.full_name,
      bio: profile.bio,
      privacy: profile.privacy,
    }).eq('id', user.id);
    if (error) Alert.alert('Update failed', error.message);
    else Alert.alert('Profile updated', 'Your changes have been saved.');
  };

  const changePhoto = async () => {
    const result = await ImagePicker.launchImageLibraryAsync({ mediaTypes: ImagePicker.MediaTypeOptions.Images, quality: 0.7 });
    if (!result.canceled && result.assets.length > 0) {
      const file = result.assets[0];
      try {
        setUploading(true);
        const ext = file.uri.split('.').pop();
        const filePath = `${user!.id}/avatar.${ext}`;
        const { error: uploadError } = await supabase.storage.from('avatars').upload(filePath, { uri: file.uri, name: filePath, type: file.type || 'image/jpeg' }, { upsert: true });
        if (uploadError) throw uploadError;
        const { data: publicURL } = supabase.storage.from('avatars').getPublicUrl(filePath);
        setProfile({ ...profile, avatar_url: publicURL.publicUrl });
        await supabase.from('profiles').update({ avatar_url: publicURL.publicUrl }).eq('id', user.id);
      } catch (error: any) {
        Alert.alert('Photo Upload Error', error.message);
      } finally {
        setUploading(false);
      }
    }
  };

  return (
    <View className="flex-1 p-4">
      <Text className="text-2xl font-bold mb-4">My Profile</Text>
      {profile.avatar_url ? (
        <Image source={{ uri: profile.avatar_url }} className="h-24 w-24 rounded-full self-center" />
      ) : (
        <View className="h-24 w-24 rounded-full self-center bg-gray-300" />
      )}
      <Pressable onPress={changePhoto} disabled={uploading} className="self-center mt-2">
        <Text className="text-blue-600">{uploading ? 'Uploading...' : 'Change Photo'}</Text>
      </Pressable>
      <Text className="mt-4">Name:</Text>
      <TextInput
        className="border rounded p-2 mb-2"
        value={profile.full_name}
        onChangeText={(text) => setProfile({ ...profile, full_name: text })}
      />
      <Text>Bio:</Text>
      <TextInput
        className="border rounded p-2 mb-2"
        value={profile.bio}
        onChangeText={(text) => setProfile({ ...profile, bio: text })}
        multiline
      />
      <Text>Privacy:</Text>
      <View className="flex-row mb-4">
        <Pressable onPress={() => setProfile({ ...profile, privacy: 'public' })} className={`mr-4 px-3 py-2 rounded ${profile.privacy === 'public' ? 'bg-blue-600' : 'bg-gray-300'}`}>
          <Text className={`${profile.privacy === 'public' ? 'text-white' : 'text-black'}`}>Public</Text>
        </Pressable>
        <Pressable onPress={() => setProfile({ ...profile, privacy: 'friends' })} className={`px-3 py-2 rounded ${profile.privacy === 'friends' ? 'bg-blue-600' : 'bg-gray-300'}`}>
          <Text className={`${profile.privacy === 'friends' ? 'text-white' : 'text-black'}`}>Friends-Only</Text>
        </Pressable>
      </View>
      <Pressable onPress={updateProfile} className="bg-green-600 p-3 rounded">
        <Text className="text-center text-white font-semibold">Save Changes</Text>
      </Pressable>
    </View>
  );
}
```

---

#### **File: src/app/(tabs)/friends.tsx**

```tsx
import { useState, useEffect } from 'react';
import { View, Text, TextInput, FlatList, Pressable, Alert } from 'react-native';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';
import { useRouter } from 'expo-router';

export default function FriendsScreen() {
  const { user } = useAuthStore();
  const [friends, setFriends] = useState<any[]>([]);
  const [requests, setRequests] = useState<any[]>([]);
  const [emailToAdd, setEmailToAdd] = useState('');
  const router = useRouter();

  useEffect(() => {
    if (!user) return;
    // Fetch accepted friends
    supabase.from('friends')
      .select('id, user_id_1, user_id_2, status')
      .or(`and(user_id_1.eq.${user.id},status.eq.accepted),and(user_id_2.eq.${user.id},status.eq.accepted)`)
      .then(async ({ data, error }) => {
        if (!error && data) {
          const friendIds = data.map(rel => (rel.user_id_1 === user.id ? rel.user_id_2 : rel.user_id_1));
          if (friendIds.length > 0) {
            const { data: profiles } = await supabase.from('profiles').select('id, full_name, avatar_url').in('id', friendIds);
            setFriends(profiles || []);
          } else {
            setFriends([]);
          }
        }
      });
    // Fetch incoming friend requests
    supabase.from('friends')
      .select('id, user_id_1')
      .eq('user_id_2', user.id)
      .eq('status', 'pending')
      .then(async ({ data, error }) => {
        if (!error && data && data.length > 0) {
          const senderIds = data.map(req => req.user_id_1);
          const { data: profiles } = await supabase.from('profiles').select('id, full_name').in('id', senderIds);
          const requestsList = data.map(req => {
            const senderProfile = profiles?.find(p => p.id === req.user_id_1);
            return { requestId: req.id, senderId: req.user_id_1, senderName: senderProfile?.full_name || 'Someone' };
          });
          setRequests(requestsList);
        } else {
          setRequests([]);
        }
      });
  }, [user]);

  const addFriend = async () => {
    if (!emailToAdd.trim()) return;
    const { data: users, error } = await supabase.from('profiles').select('id').ilike('email', emailToAdd.trim());
    if (error) {
      Alert.alert('Error', error.message);
      return;
    }
    if (!users || users.length === 0) {
      Alert.alert('User not found', 'No user with that email.');
      return;
    }
    const targetId = users[0].id;
    if (targetId === user?.id) {
      Alert.alert('Oops', 'You cannot add yourself as a friend.');
      return;
    }
    const { error: insertError } = await supabase.from('friends').insert({ user_id_1: user?.id, user_id_2: targetId, status: 'pending' });
    if (insertError) Alert.alert('Error', insertError.message);
    else {
      Alert.alert('Friend Request Sent', 'Your friend request has been sent.');
      setEmailToAdd('');
    }
  };

  const acceptRequest = async (requestId: string) => {
    const { error } = await supabase.from('friends').update({ status: 'accepted' }).eq('id', requestId);
    if (error) {
      Alert.alert('Error', error.message);
    } else {
      const acceptedReq = requests.find(r => r.requestId === requestId);
      if (acceptedReq) {
        const newFriendProfile = { id: acceptedReq.senderId, full_name: acceptedReq.senderName, avatar_url: null };
        setFriends([...friends, newFriendProfile]);
      }
      setRequests(requests.filter(r => r.requestId !== requestId));
    }
  };

  return (
    <View className="flex-1 p-4">
      <Text className="text-2xl font-bold mb-4">Friends</Text>
      <Text className="text-lg mb-2">Add Friend by Email:</Text>
      <View className="flex-row mb-4">
        <TextInput
          className="flex-1 border rounded p-2 mr-2"
          placeholder="Email address"
          value={emailToAdd}
          onChangeText={setEmailToAdd}
        />
        <Pressable onPress={addFriend} className="bg-blue-600 px-4 py-2 rounded">
          <Text className="text-white font-semibold">Add</Text>
        </Pressable>
      </View>
      {requests.length > 0 && (
        <>
          <Text className="text-lg font-semibold mb-2">Friend Requests:</Text>
          {requests.map(req => (
            <View key={req.requestId} className="flex-row justify-between items-center mb-2 bg-gray-100 p-2 rounded">
              <Text>{req.senderName} sent you a request</Text>
              <Pressable onPress={() => acceptRequest(req.requestId)} className="bg-green-500 px-3 py-1 rounded">
                <Text className="text-white">Accept</Text>
              </Pressable>
            </View>
          ))}
        </>
      )}
      <Text className="text-lg font-semibold mt-2 mb-2">Your Friends:</Text>
      {friends.length === 0 ? (
        <Text>You have no friends yet.</Text>
      ) : (
        <FlatList
          data={friends}
          keyExtractor={(item) => item.id}
          renderItem={({ item }) => (
            <Pressable className="p-2 border-b border-gray-200" onPress={() => router.push(`/post/${item.id}`)}>
              <Text className="text-base">{item.full_name}</Text>
            </Pressable>
          )}
        />
      )}
    </View>
  );
}
```

---

#### **File: src/app/(tabs)/notifications.tsx**

```tsx
import { useEffect, useState } from 'react';
import { View, Text, FlatList, Alert } from 'react-native';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';

interface Notification {
  id: string;
  type: string;
  actor_id: string;
  entity_id: string | null;
  seen: boolean;
  created_at: string;
}

export default function NotificationsScreen() {
  const { user } = useAuthStore();
  const [notifications, setNotifications] = useState<Notification[]>([]);

  useEffect(() => {
    if (!user) return;
    const fetchNotifications = async () => {
      const { data, error } = await supabase
        .from('notifications')
        .select('*')
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });
      if (error) {
        Alert.alert('Error', error.message);
      } else {
        setNotifications(data || []);
      }
    };
    fetchNotifications();
  }, [user]);

  return (
    <View className="flex-1 p-4 bg-white">
      <Text className="text-2xl font-bold mb-4">Notifications</Text>
      <FlatList
        data={notifications}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View className="p-3 border-b border-gray-200">
            <Text className="font-semibold">{item.type}</Text>
            <Text className="text-sm text-gray-600">{new Date(item.created_at).toLocaleString()}</Text>
          </View>
        )}
        ListEmptyComponent={<Text>No notifications.</Text>}
      />
    </View>
  );
}
```

---

#### **File: src/app/post/[id].tsx**  
*(View, edit, and delete a post)*

```tsx
import { useLocalSearchParams, useRouter } from 'expo-router';
import { useEffect, useState } from 'react';
import { View, Text, TextInput, Image, Pressable, Alert } from 'react-native';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';

interface Post {
  id: string;
  user_id: string;
  content: string;
  image_url: string | null;
  created_at: string;
}

export default function PostDetailScreen() {
  const { id } = useLocalSearchParams<{ id: string }>();
  const { user } = useAuthStore();
  const router = useRouter();
  const [post, setPost] = useState<Post | null>(null);
  const [editMode, setEditMode] = useState(false);
  const [editedContent, setEditedContent] = useState('');

  useEffect(() => {
    if (!id) return;
    supabase
      .from('posts')
      .select('id, user_id, content, image_url, created_at')
      .eq('id', id)
      .single()
      .then(({ data, error }) => {
        if (error) {
          Alert.alert('Error', error.message);
        } else if (data) {
          setPost(data);
          setEditedContent(data.content);
        }
      });
  }, [id]);

  const updatePost = async () => {
    if (!post) return;
    const { error } = await supabase
      .from('posts')
      .update({ content: editedContent })
      .eq('id', post.id);
    if (error) {
      Alert.alert('Error', error.message);
    } else {
      Alert.alert('Success', 'Post updated.');
      setEditMode(false);
      setPost({ ...post, content: editedContent });
    }
  };

  const deletePost = async () => {
    if (!post) return;
    const { error } = await supabase.from('posts').delete().eq('id', post.id);
    if (error) {
      Alert.alert('Error', error.message);
    } else {
      Alert.alert('Deleted', 'Post has been deleted.');
      router.back();
    }
  };

  if (!post) return <View className="flex-1 justify-center items-center"><Text>Loading...</Text></View>;

  return (
    <View className="flex-1 p-4 bg-white">
      {post.image_url && <Image source={{ uri: post.image_url }} className="w-full h-64 rounded mb-4" />}
      {editMode ? (
        <TextInput
          className="border rounded p-2 mb-4"
          value={editedContent}
          onChangeText={setEditedContent}
          multiline
        />
      ) : (
        <Text className="mb-4">{post.content}</Text>
      )}
      {user && user.id === post.user_id && (
        <View className="flex-row space-x-4">
          {editMode ? (
            <>
              <Pressable onPress={updatePost} className="bg-green-600 px-4 py-2 rounded">
                <Text className="text-white">Save</Text>
              </Pressable>
              <Pressable
                onPress={() => {
                  setEditMode(false);
                  setEditedContent(post.content);
                }}
                className="bg-gray-600 px-4 py-2 rounded"
              >
                <Text className="text-white">Cancel</Text>
              </Pressable>
            </>
          ) : (
            <>
              <Pressable onPress={() => setEditMode(true)} className="bg-blue-600 px-4 py-2 rounded">
                <Text className="text-white">Edit</Text>
              </Pressable>
              <Pressable onPress={deletePost} className="bg-red-600 px-4 py-2 rounded">
                <Text className="text-white">Delete</Text>
              </Pressable>
            </>
          )}
        </View>
      )}
    </View>
  );
}
```

---

#### **File: src/app/chat/[id].tsx**

```tsx
import { useLocalSearchParams } from 'expo-router';
import { useEffect, useState, useRef } from 'react';
import { View, Text, TextInput, FlatList, Pressable, KeyboardAvoidingView } from 'react-native';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';

interface Message {
  id: string;
  sender_id: string;
  receiver_id: string;
  content: string;
  created_at: string;
}

export default function ChatScreen() {
  const { id: friendId } = useLocalSearchParams();
  const { user } = useAuthStore();
  const [messages, setMessages] = useState<Message[]>([]);
  const [text, setText] = useState('');
  const flatListRef = useRef<FlatList>(null);

  useEffect(() => {
    if (!user || !friendId) return;
    const friendIdStr = friendId.toString();
    supabase.from('messages')
      .select('*')
      .or(`and(sender_id.eq.${user.id},receiver_id.eq.${friendIdStr}),and(sender_id.eq.${friendIdStr},receiver_id.eq.${user.id})`)
      .order('created_at', { ascending: true })
      .then(({ data, error }) => {
        if (!error && data) setMessages(data);
      });
    const channel = supabase.channel('chat-channel')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages', filter: `receiver_id=eq.${user.id}` }, (payload) => {
        const newMsg = payload.new as Message;
        if ((newMsg.sender_id === friendIdStr && newMsg.receiver_id === user.id) ||
            (newMsg.sender_id === user.id && newMsg.receiver_id === friendIdStr)) {
          setMessages(prev => [...prev, newMsg]);
          flatListRef.current?.scrollToEnd({ animated: true });
        }
      })
      .subscribe();
    return () => supabase.removeChannel(channel);
  }, [user, friendId]);

  const sendMessage = async () => {
    if (!text.trim() || !user || !friendId) return;
    const friendIdStr = friendId.toString();
    const { error } = await supabase.from('messages').insert({
      sender_id: user.id,
      receiver_id: friendIdStr,
      content: text.trim(),
    });
    if (!error) setText('');
  };

  return (
    <KeyboardAvoidingView style={{ flex: 1 }} behavior="padding">
      <FlatList
        ref={flatListRef}
        data={messages}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{
            alignSelf: item.sender_id === user?.id ? 'flex-end' : 'flex-start',
            backgroundColor: item.sender_id === user?.id ? '#DCF8C6' : '#FFF',
            padding: 8, borderRadius: 5, marginVertical: 2, maxWidth: '80%'
          }}>
            <Text>{item.content}</Text>
          </View>
        )}
        contentContainerStyle={{ padding: 10 }}
        onContentSizeChange={() => flatListRef.current?.scrollToEnd({ animated: true })}
      />
      <View className="flex-row items-center border-t border-gray-300 p-2">
        <TextInput
          className="flex-1 p-2"
          placeholder="Type a message..."
          value={text}
          onChangeText={setText}
        />
        <Pressable onPress={sendMessage} className="px-3 py-2 bg-blue-600 rounded">
          <Text className="text-white">Send</Text>
        </Pressable>
      </View>
    </KeyboardAvoidingView>
  );
}
```

---

#### **File: src/app/(admin)/reports.tsx**

```tsx
import { useEffect, useState } from 'react';
import { View, Text, FlatList, Pressable, Alert } from 'react-native';
import { supabase } from '../../supabase';
import { useAuthStore } from '../../store';

interface Report {
  id: string;
  post_id: string;
  reason: string;
  reported_by: string;
  created_at: string;
  post_content?: string;
  reporter_email?: string;
}

export default function ReportsScreen() {
  const { user } = useAuthStore();
  const [reports, setReports] = useState<Report[]>([]);

  useEffect(() => {
    if (!user) return;
    supabase.from('reports')
      .select('id, post_id, reason, reported_by, created_at, posts(content), profiles(email)')
      .eq('status', 'open')
      .then(({ data, error }) => {
        if (!error && data) {
          const formatted = data.map(r => ({
            id: r.id,
            post_id: r.post_id,
            reason: r.reason,
            reported_by: r.reported_by,
            created_at: r.created_at,
            post_content: r.posts?.content,
            reporter_email: r.profiles?.email,
          }));
          setReports(formatted);
        }
      });
  }, [user]);

  const resolveReport = async (reportId: string, action: 'remove' | 'ignore') => {
    if (action === 'remove') {
      const report = reports.find(r => r.id === reportId);
      if (report) {
        const { error: postErr } = await supabase.from('posts').delete().eq('id', report.post_id);
        if (postErr) return Alert.alert('Error', 'Failed to delete post: ' + postErr.message);
      }
    }
    const { error } = await supabase.from('reports').update({ status: 'resolved', resolved_by: user?.id }).eq('id', reportId);
    if (error) Alert.alert('Error', error.message);
    else setReports(reports.filter(r => r.id !== reportId));
  };

  return (
    <View className="flex-1 p-4">
      <Text className="text-2xl font-bold mb-4">Reported Posts</Text>
      <FlatList
        data={reports}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View className="mb-4 p-3 bg-white rounded">
            <Text><Text className="font-semibold">Post ID:</Text> {item.post_id}</Text>
            <Text><Text className="font-semibold">Content:</Text> {item.post_content || '(No content)'}</Text>
            <Text><Text className="font-semibold">Reported by:</Text> {item.reporter_email}</Text>
            <Text><Text className="font-semibold">Reason:</Text> {item.reason}</Text>
            <Text><Text className="font-semibold">Date:</Text> {new Date(item.created_at).toLocaleString()}</Text>
            <View className="flex-row mt-2">
              <Pressable className="bg-red-600 px-3 py-1 mr-2 rounded" onPress={() => resolveReport(item.id, 'remove')}>
                <Text className="text-white">Remove Post</Text>
              </Pressable>
              <Pressable className="bg-gray-500 px-3 py-1 rounded" onPress={() => resolveReport(item.id, 'ignore')}>
                <Text className="text-white">Ignore</Text>
              </Pressable>
            </View>
          </View>
        )}
        ListEmptyComponent={<Text>No reports.</Text>}
      />
    </View>
  );
}
```

---

#### **File: src/app/(admin)/analytics.tsx**

```tsx
import { useEffect, useState } from 'react';
import { View, Text, Alert } from 'react-native';
import { supabase } from '../../supabase';

export default function AnalyticsScreen() {
  const [stats, setStats] = useState({
    users: 0,
    posts: 0,
    friends: 0,
  });

  useEffect(() => {
    const fetchStats = async () => {
      try {
        const { count: userCount } = await supabase
          .from('profiles')
          .select('*', { count: 'exact', head: true });
        const { count: postCount } = await supabase
          .from('posts')
          .select('*', { count: 'exact', head: true });
        const { count: friendCount } = await supabase
          .from('friends')
          .select('*', { count: 'exact', head: true });
        setStats({
          users: userCount || 0,
          posts: postCount || 0,
          friends: friendCount || 0,
        });
      } catch (error: any) {
        Alert.alert('Error', error.message);
      }
    };
    fetchStats();
  }, []);

  return (
    <View className="flex-1 p-4 bg-white">
      <Text className="text-2xl font-bold mb-4">Analytics</Text>
      <Text className="text-lg">Total Users: {stats.users}</Text>
      <Text className="text-lg">Total Posts: {stats.posts}</Text>
      <Text className="text-lg">Total Friend Connections: {stats.friends}</Text>
    </View>
  );
}
```

---

#### **File: supabase_setup.sql**

```sql
-- Profiles table
create table if not exists profiles (
  id uuid primary key references auth.users(id) on delete cascade,
  full_name text,
  bio text,
  avatar_url text,
  privacy text check (privacy in ('public', 'friends')) default 'public',
  is_admin boolean default false,
  expo_push_token text,
  created_at timestamp with time zone default now()
);

create or replace function public.handle_new_user()
returns trigger as $$
begin
  insert into public.profiles(id) values (new.id);
  return new;
end;
$$ language plpgsql security definer;

create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();

-- Posts table
create table if not exists posts (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id) on delete cascade,
  content text,
  image_url text,
  created_at timestamp with time zone default now()
);

-- Friends table
create table if not exists friends (
  id uuid primary key default gen_random_uuid(),
  user_id_1 uuid references auth.users(id) on delete cascade,
  user_id_2 uuid references auth.users(id) on delete cascade,
  status text check (status in ('pending','accepted','rejected')) default 'pending',
  created_at timestamp with time zone default now()
);

-- Messages table
create table if not exists messages (
  id bigint primary key generated always as identity,
  sender_id uuid references auth.users(id) on delete cascade,
  receiver_id uuid references auth.users(id) on delete cascade,
  content text,
  created_at timestamp with time zone default now()
);

-- Notifications table
create table if not exists notifications (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id) on delete cascade,
  type text,
  actor_id uuid references auth.users(id),
  entity_id uuid,
  seen boolean default false,
  created_at timestamp with time zone default now()
);

-- Reports table
create table if not exists reports (
  id uuid primary key default gen_random_uuid(),
  post_id uuid references posts(id) on delete cascade,
  reported_by uuid references auth.users(id),
  reason text,
  status text check (status in ('open','resolved','ignored')) default 'open',
  resolved_by uuid references auth.users(id),
  created_at timestamp with time zone default now(),
  resolved_at timestamp with time zone
);

-- Enable RLS on all tables
alter table profiles enable row level security;
alter table posts enable row level security;
alter table friends enable row level security;
alter table messages enable row level security;
alter table notifications enable row level security;
alter table reports enable row level security;

-- RLS for profiles
create policy "profiles_select_public_or_friends" on profiles
for select using (
  privacy = 'public'
  or auth.uid() = id
  or (
    privacy = 'friends'
    and exists(
      select 1 from friends 
      where status = 'accepted'
        and ((friends.user_id_1 = profiles.id and friends.user_id_2 = auth.uid()) 
          or (friends.user_id_2 = profiles.id and friends.user_id_1 = auth.uid()))
    )
  )
);
create policy "profiles_select_self" on profiles
as permissive for select to authenticated
using ( auth.uid() = id );
create policy "profiles_insert" on profiles
for insert to authenticated
with check ( id = auth.uid() );
create policy "profiles_update" on profiles
for update to authenticated
using ( auth.uid() = id ) with check ( auth.uid() = id );
create policy "profiles_update_admin" on profiles
as permissive for update to authenticated
using ( exists(select 1 from profiles as p where p.id = auth.uid() and p.is_admin = true) )
with check ( true );

-- RLS for posts
create policy "posts_select" on posts
for select to authenticated
using (
  auth.uid() = user_id
  or exists(
      select 1 from profiles where profiles.id = posts.user_id 
      and profiles.privacy = 'public'
  )
  or exists(
      select 1 from friends where status = 'accepted'
      and ((friends.user_id_1 = posts.user_id and friends.user_id_2 = auth.uid()) 
        or (friends.user_id_2 = posts.user_id and friends.user_id_1 = auth.uid()))
  )
);
create policy "posts_insert" on posts
for insert to authenticated
with check ( auth.uid() = user_id );
create policy "posts_update_owner" on posts
for update to authenticated
using ( auth.uid() = user_id )
with check ( auth.uid() = user_id );
create policy "posts_delete_owner" on posts
for delete to authenticated
using ( auth.uid() = user_id );
create policy "posts_delete_admin" on posts
as permissive for delete to authenticated
using ( exists(select 1 from profiles where id = auth.uid() and is_admin = true) );

-- RLS for friends
create policy "friends_select_participants" on friends
for select to authenticated
using (
  auth.uid() = user_id_1 or auth.uid() = user_id_2
);
create policy "friends_insert_request" on friends
for insert to authenticated
with check ( auth.uid() = user_id_1 AND status = 'pending' );
create policy "friends_update_accept" on friends
for update to authenticated
using ( auth.uid() = user_id_1 OR auth.uid() = user_id_2 )
with check (
  (status = 'accepted' OR status = 'rejected')
);
create policy "friends_delete" on friends
for delete to authenticated
using (
  auth.uid() = user_id_1 OR auth.uid() = user_id_2
);

-- RLS for messages
create policy "messages_select_participants" on messages
for select to authenticated
using ( auth.uid() = sender_id OR auth.uid() = receiver_id );
create policy "messages_insert" on messages
for insert to authenticated
with check (
  auth.uid() = sender_id 
  AND exists(
      select 1 from friends 
      where status = 'accepted'
        and ((friends.user_id_1 = auth.uid() and friends.user_id_2 = receiver_id) 
           or (friends.user_id_2 = auth.uid() and friends.user_id_1 = receiver_id))
  )
);

-- RLS for notifications
create policy "notifications_select" on notifications
for select to authenticated
using ( auth.uid() = user_id );
create policy "notifications_insert" on notifications
for insert with check ( auth.uid() = user_id );

-- RLS for reports
create policy "reports_select" on reports
for select to authenticated
using (
  auth.uid() = reported_by 
  or exists(select 1 from profiles where id = auth.uid() and is_admin = true)
);
create policy "reports_insert" on reports
for insert to authenticated
with check ( auth.uid() = reported_by );
create policy "reports_update" on reports
for update to authenticated
using ( exists(select 1 from profiles where id = auth.uid() and is_admin = true) )
with check ( true );
create policy "reports_delete" on reports
for delete to authenticated
using ( exists(select 1 from profiles where id = auth.uid() and is_admin = true) );
```

---

### Final Notes

• All environment variables are named exactly as:  
  **EXPO_PUBLIC_SUPABASE_URL**  
  **EXPO_PUBLIC_SUPABASE_ANON_KEY**

• For OAuth flows, extend the (auth) screens with additional buttons using  
  `supabase.auth.signInWithOAuth({ provider: 'google' })` etc.

• For push notifications, configure Expo Notifications and Supabase Edge Functions separately.

This complete code base covers all core functionality for your MVP. Adjust and expand as needed for your project. Happy coding!
