Below is a **complete, end‑to‑end tutorial** that not only covers setting up your Supabase backend, creating your Expo SDK‑52 project with Expo Router, authentication, social features, and an admin dashboard—but also now includes a working **app/index.tsx** file. This file serves as the root entry point and redirects users based on their authentication status (to `/ (auth)/login` if not signed in, or to `/ (protected)/home` if signed in).

> **Important:**  
> – Replace the Supabase URL and anon key with your own values.  
> – If you encounter issues with folder names containing parentheses (e.g. `(auth)`), you can either rename them (e.g. use `auth` instead) or ensure that all file and folder paths are wrapped in quotes (as shown in the shell script).  
> – After making changes, restart your Expo/Metro bundler.

---

## Table of Contents

1. [Supabase Backend Setup](#supabase-backend-setup)  
  1.1 [SQL Commands to Create Tables and RLS Policies](#sql-commands-to-create-tables-and-rls-policies)  
  1.2 [User Auto‑Creation Trigger with Role Assignment](#user-auto-creation-trigger-with-role-assignment)

2. [Expo Project Setup & Environment Variables](#expo-project-setup--environment-variables)

3. [Supabase Client Configuration](#supabase-client-configuration)

4. [Authentication Context & Global Layout](#authentication-context--global-layout)

5. [Routing with Expo Router (Protected & Admin Groups)](#routing-with-expo-router-protected--admin-groups)  
  5.1 [Protected Routes Layout](#protected-routes-layout)  
  5.2 [Admin Routes Layout](#admin-routes-layout)

6. [Authentication Screens (Login & Signup) with Visual Feedback](#authentication-screens-login--signup-with-visual-feedback)

7. [Social Network Features](#social-network-features)  
  7.1 [Home Feed & Creating Posts](#home-feed--creating-posts)  
  7.2 [Chat Functionality](#chat-functionality)

8. [Admin Dashboard](#admin-dashboard)

9. [Root Route – app/index.tsx](#root-route--appindextsx)

10. [Automated Setup Bash Script](#automated-setup-bash-script)

11. [Final Notes & Next Steps](#final-notes--next-steps)

---

## 1. Supabase Backend Setup

### 1.1 SQL Commands to Create Tables and RLS Policies

Run the following SQL commands in your Supabase SQL Editor:

```sql
-- 1. Create the "users" table with a "role" column.
CREATE TABLE public.users (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  email text NOT NULL UNIQUE,
  image text,
  bio text,
  role text NOT NULL DEFAULT 'user',
  created_at timestamptz DEFAULT now()
);

-- Enable RLS on the users table.
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;

-- Users table RLS policies.
CREATE POLICY "Users select for authenticated"
  ON public.users
  FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Users insert for authenticated"
  ON public.users
  FOR INSERT
  WITH CHECK (auth.uid() = id);

CREATE POLICY "Users update for owner"
  ON public.users
  FOR UPDATE
  USING (auth.uid() = id);

CREATE POLICY "Users delete for owner"
  ON public.users
  FOR DELETE
  USING (auth.uid() = id);

--------------------------------------------------

-- 2. Create the "posts" table.
CREATE TABLE public.posts (
  id serial PRIMARY KEY,
  user_id uuid REFERENCES public.users(id) ON DELETE CASCADE,
  body text,
  file text,
  created_at timestamptz DEFAULT now()
);

-- Enable RLS on posts table.
ALTER TABLE public.posts ENABLE ROW LEVEL SECURITY;

-- Posts table RLS policies.
CREATE POLICY "Posts select for authenticated"
  ON public.posts
  FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Posts insert for owner"
  ON public.posts
  FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Posts update for owner"
  ON public.posts
  FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Posts delete for owner"
  ON public.posts
  FOR DELETE
  USING (auth.uid() = user_id);

--------------------------------------------------

-- 3. Create the "comments" table.
CREATE TABLE public.comments (
  id serial PRIMARY KEY,
  post_id integer REFERENCES public.posts(id) ON DELETE CASCADE,
  user_id uuid REFERENCES public.users(id) ON DELETE CASCADE,
  text text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Enable RLS on comments table.
ALTER TABLE public.comments ENABLE ROW LEVEL SECURITY;

-- Comments table RLS policies.
CREATE POLICY "Comments select for authenticated"
  ON public.comments
  FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Comments insert for owner"
  ON public.comments
  FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Comments update for owner"
  ON public.comments
  FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Comments delete for owner"
  ON public.comments
  FOR DELETE
  USING (auth.uid() = user_id);

--------------------------------------------------

-- 4. Create the "chat_messages" table.
CREATE TABLE public.chat_messages (
  id serial PRIMARY KEY,
  user_id uuid REFERENCES public.users(id) ON DELETE CASCADE,
  message text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Enable RLS on chat_messages table.
ALTER TABLE public.chat_messages ENABLE ROW LEVEL SECURITY;

-- Chat messages RLS policies.
CREATE POLICY "Chat select for authenticated"
  ON public.chat_messages
  FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Chat insert for owner"
  ON public.chat_messages
  FOR INSERT
  WITH CHECK (auth.uid() = user_id);

--------------------------------------------------

-- 5. Create the "notifications" table.
CREATE TABLE public.notifications (
  id serial PRIMARY KEY,
  sender_id uuid REFERENCES public.users(id) ON DELETE CASCADE,
  receiver_id uuid REFERENCES public.users(id) ON DELETE CASCADE,
  title text NOT NULL,
  data jsonb,
  created_at timestamptz DEFAULT now()
);

-- Enable RLS on notifications table.
ALTER TABLE public.notifications ENABLE ROW LEVEL SECURITY;

-- Notifications table RLS policies.
CREATE POLICY "Notifications select for receiver"
  ON public.notifications
  FOR SELECT
  USING (auth.uid() = receiver_id);

CREATE POLICY "Notifications insert for sender"
  ON public.notifications
  FOR INSERT
  WITH CHECK (auth.uid() = sender_id);
```

### 1.2 User Auto‑Creation Trigger with Role Assignment

Run the following SQL to create a trigger that automatically creates a user record when a new user signs up. The first user is assigned the role `"admin"` and subsequent users default to `"user"` (unless specified):

```sql
-- Ensure the "role" column exists.
ALTER TABLE public.users ADD COLUMN IF NOT EXISTS role text NOT NULL DEFAULT 'user';

-- Create or replace a function to handle new user signups.
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger AS $$
DECLARE
  user_count int;
  role_to_set text;
BEGIN
  SELECT count(*) INTO user_count FROM public.users;
  IF user_count = 0 THEN
    role_to_set := 'admin';
  ELSE
    role_to_set := COALESCE(new.user_metadata->>'role', 'user');
  END IF;

  INSERT INTO public.users (id, email, name, role)
  VALUES (new.id, new.email, COALESCE(new.user_metadata->>'name', 'Anonymous'), role_to_set);
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Create a trigger on auth.users insert event.
CREATE TRIGGER on_auth_user_created
AFTER INSERT ON auth.users
FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();
```

---

## 2. Expo Project Setup & Environment Variables

Run these commands from your repository root:

```bash
npx create-expo-app ScriptHammer
cd ScriptHammer
npm run reset-project
rm -rf app-example
```

> **Note:** The default Expo project may include files such as `app/index.tsx` and `app/_layout.tsx`. Delete these so that your custom files are used:
>
> ```bash
> rm -f app/index.tsx
> rm -f app/_layout.tsx
> ```

Then, edit your **app.json** so its `extra` field exactly matches (using double quotes):

```json
{
  "expo": {
    "name": "ScriptHammer",
    "slug": "ScriptHammer",
    "version": "1.0.0",
    "extra": {
      "EXPO_PUBLIC_SUPABASE_URL": "https://judtlzmkvugqbgmgxgfv.supabase.co",
      "EXPO_PUBLIC_SUPABASE_ANON_KEY": "YOUR_SUPABASE_ANON_KEY_HERE"
    },
    "orientation": "portrait",
    "icon": "./assets/images/icon.png",
    "scheme": "myapp",
    "userInterfaceStyle": "automatic",
    "newArchEnabled": true,
    "ios": {
      "supportsTablet": true
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/images/adaptive-icon.png",
        "backgroundColor": "#ffffff"
      }
    },
    "web": {
      "bundler": "metro",
      "output": "static",
      "favicon": "./assets/images/favicon.png"
    },
    "plugins": [
      "expo-router",
      [
        "expo-splash-screen",
        {
          "image": "./assets/images/splash-icon.png",
          "imageWidth": 200,
          "resizeMode": "contain",
          "backgroundColor": "#ffffff"
        }
      ]
    ],
    "experiments": {
      "typedRoutes": true
    }
  }
}
```

Finally, install the required dependencies:

```bash
npm install @supabase/supabase-js expo-router expo-image-picker
```

---

## 3. Supabase Client Configuration

Create a new file **lib/supabaseClient.ts** with the following code:

```tsx
// lib/supabaseClient.ts
import { createClient } from "@supabase/supabase-js";
import Constants from "expo-constants";

// Try reading from either Constants.manifest.extra or Constants.expoConfig.extra
const extras = Constants.manifest?.extra || Constants.expoConfig?.extra || {};
const { EXPO_PUBLIC_SUPABASE_URL, EXPO_PUBLIC_SUPABASE_ANON_KEY } = extras;

if (!EXPO_PUBLIC_SUPABASE_URL || !EXPO_PUBLIC_SUPABASE_ANON_KEY) {
  throw new Error(
    "Missing Supabase environment variables. Please set EXPO_PUBLIC_SUPABASE_URL and EXPO_PUBLIC_SUPABASE_ANON_KEY in your app.json extra field."
  );
}

export const supabase = createClient(EXPO_PUBLIC_SUPABASE_URL, EXPO_PUBLIC_SUPABASE_ANON_KEY);
```

---

## 4. Authentication Context & Global Layout

### 4.1 Auth Provider

Place the AuthProvider in a folder named **context** (without parentheses) so that Expo Router doesn’t treat it as a route. Create **app/context/AuthProvider.tsx**:

```tsx
// app/context/AuthProvider.tsx
import React, { createContext, useContext, useState, useEffect } from "react";
import { supabase } from "../../lib/supabaseClient";

interface AuthContextProps {
  user: any;
  loading: boolean;
  setUser: (user: any) => void;
}

const AuthContext = createContext<AuthContextProps | undefined>(undefined);

export const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  const [user, setUser] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);

  useEffect(() => {
    async function getSession() {
      const { data: { session } } = await supabase.auth.getSession();
      setUser(session?.user ?? null);
      setLoading(false);
    }
    getSession();

    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  return (
    <AuthContext.Provider value={{ user, loading, setUser }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error("useAuth must be used within an AuthProvider");
  return context;
};

export default AuthProvider;
```

### 4.2 Global Layout

Create **app/_layout.tsx** (this global layout wraps all routes with the AuthProvider):

```tsx
// app/_layout.tsx
import React from "react";
import { Slot } from "expo-router";
import { AuthProvider } from "./context/AuthProvider";

export default function RootLayout() {
  return (
    <AuthProvider>
      <Slot />
    </AuthProvider>
  );
}
```

---

## 5. Routing with Expo Router (Protected & Admin Groups)

### 5.1 Protected Routes Layout

Create **app/(protected)/_layout.tsx**. (Note: In this file path, the folder name is `(protected)`. If you encounter shell issues with parentheses, be sure to wrap file paths in quotes.)

```tsx
// app/(protected)/_layout.tsx
import React, { useEffect } from "react";
import { View, ActivityIndicator, StyleSheet } from "react-native";
import { useRouter, useSegments } from "expo-router";
import { useAuth } from "../context/AuthProvider";

export default function ProtectedLayout({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const segments = useSegments();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user && segments[0] === "(protected)") {
      router.replace("/(auth)/login");
    }
  }, [user, loading, segments, router]);

  if (loading || (!user && segments[0] === "(protected)")) {
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );
  }
  return <>{children}</>;
}

const styles = StyleSheet.create({
  center: { flex: 1, justifyContent: "center", alignItems: "center" },
});
```

### 5.2 Admin Routes Layout

Create **app/(admin)/_layout.tsx**:

```tsx
// app/(admin)/_layout.tsx
import React, { useEffect } from "react";
import { View, ActivityIndicator, StyleSheet } from "react-native";
import { useRouter, useSegments } from "expo-router";
import { useAuth } from "../context/AuthProvider";

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const segments = useSegments();
  const router = useRouter();

  useEffect(() => {
    if (!loading && user && user.app_metadata?.role !== "admin") {
      router.replace("/(protected)/home");
    }
  }, [user, loading, segments, router]);

  if (loading || (user && user.app_metadata?.role !== "admin")) {
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );
  }
  return <>{children}</>;
}

const styles = StyleSheet.create({
  center: { flex: 1, justifyContent: "center", alignItems: "center" },
});
```

---

## 6. Authentication Screens (Login & Signup) with Visual Feedback

### 6.1 Login Screen

Create **app/(auth)/login.tsx**:

```tsx
// app/(auth)/login.tsx
import React, { useState } from "react";
import { View, TextInput, Button, ActivityIndicator, StyleSheet, Text } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";
import { Link, useRouter } from "expo-router";

export default function LoginScreen() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [errorMsg, setErrorMsg] = useState("");
  const [submitting, setSubmitting] = useState(false);
  const { setUser } = useAuth();
  const router = useRouter();

  const handleLogin = async () => {
    setErrorMsg("");
    if (!email || !password) {
      setErrorMsg("Please fill all fields.");
      return;
    }
    setSubmitting(true);
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    setSubmitting(false);
    if (error) {
      setErrorMsg(`Login Error: ${error.message}`);
    } else {
      setUser(data.session?.user);
      router.replace("/(protected)/home");
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Login</Text>
      <TextInput placeholder="Email" value={email} onChangeText={setEmail} style={styles.input} autoCapitalize="none" />
      <TextInput placeholder="Password" value={password} onChangeText={setPassword} secureTextEntry style={styles.input} />
      {submitting ? <ActivityIndicator size="large" /> : <Button title="Login" onPress={handleLogin} />}
      {errorMsg ? <Text style={styles.errorText}>{errorMsg}</Text> : null}
      <Link href="/(auth)/signup" style={styles.link}>
        Don't have an account? Sign Up
      </Link>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, justifyContent: "center" },
  title: { fontSize: 24, marginBottom: 20, textAlign: "center" },
  input: { height: 40, borderWidth: 1, borderColor: "#ccc", marginBottom: 15, paddingHorizontal: 10 },
  link: { marginTop: 20, textAlign: "center", color: "blue" },
  errorText: { color: "red", textAlign: "center", marginTop: 10 },
});
```

### 6.2 Signup Screen

Create **app/(auth)/signup.tsx**:

```tsx
// app/(auth)/signup.tsx
import React, { useState } from "react";
import { View, TextInput, Button, ActivityIndicator, StyleSheet, Text } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";
import { Link, useRouter } from "expo-router";

export default function SignupScreen() {
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [errorMsg, setErrorMsg] = useState("");
  const [submitting, setSubmitting] = useState(false);
  const { setUser } = useAuth();
  const router = useRouter();

  const handleSignup = async () => {
    setErrorMsg("");
    if (!name || !email || !password) {
      setErrorMsg("Please fill all fields.");
      return;
    }
    setSubmitting(true);
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: { data: { name } },
    });
    setSubmitting(false);
    if (error) {
      setErrorMsg(`Signup Error: ${error.message}`);
    } else {
      setUser(data.session?.user);
      router.replace("/(protected)/home");
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Sign Up</Text>
      <TextInput placeholder="Name" value={name} onChangeText={setName} style={styles.input} />
      <TextInput placeholder="Email" value={email} onChangeText={setEmail} style={styles.input} autoCapitalize="none" />
      <TextInput placeholder="Password" value={password} onChangeText={setPassword} secureTextEntry style={styles.input} />
      {submitting ? <ActivityIndicator size="large" /> : <Button title="Sign Up" onPress={handleSignup} />}
      {errorMsg ? <Text style={styles.errorText}>{errorMsg}</Text> : null}
      <Link href="/(auth)/login" style={styles.link}>
        Already have an account? Login
      </Link>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, justifyContent: "center" },
  title: { fontSize: 24, marginBottom: 20, textAlign: "center" },
  input: { height: 40, borderWidth: 1, borderColor: "#ccc", marginBottom: 15, paddingHorizontal: 10 },
  link: { marginTop: 20, textAlign: "center", color: "blue" },
  errorText: { color: "red", textAlign: "center", marginTop: 10 },
});
```

---

## 7. Social Network Features

### 7.1 Home Feed & Creating Posts

#### Home Feed

Create **app/(protected)/home.tsx**:

```tsx
// app/(protected)/home.tsx
import React, { useEffect, useState } from "react";
import { View, Text, FlatList, ActivityIndicator, StyleSheet, RefreshControl } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";
import { useRouter } from "expo-router";

export default function HomeScreen() {
  const { user } = useAuth();
  const [posts, setPosts] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(false);
  const [limit, setLimit] = useState<number>(10);
  const [hasMore, setHasMore] = useState<boolean>(true);
  const router = useRouter();

  const fetchPosts = async () => {
    setLoading(true);
    const { data, error } = await supabase
      .from("posts")
      .select(`*, user:users(id, name, image)`)
      .order("created_at", { ascending: false })
      .limit(limit);
    if (error) {
      console.error("Error fetching posts:", error);
    } else {
      setPosts(data);
      if (data.length < limit) setHasMore(false);
    }
    setLoading(false);
  };

  useEffect(() => {
    fetchPosts();
  }, [limit]);

  useEffect(() => {
    const postChannel = supabase
      .channel("posts")
      .on(
        "postgres_changes",
        { event: "INSERT", schema: "public", table: "posts" },
        (payload) => {
          setPosts((prev) => [payload.new, ...prev]);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(postChannel);
    };
  }, []);

  const loadMore = () => {
    if (hasMore && !loading) {
      setLimit(limit + 10);
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.header}>Welcome, {user?.email}</Text>
      <FlatList
        data={posts}
        keyExtractor={(item) => String(item.id)}
        renderItem={({ item }) => (
          <View style={styles.postCard}>
            <Text style={styles.postBody}>{item.body}</Text>
          </View>
        )}
        onEndReached={loadMore}
        onEndReachedThreshold={0.5}
        refreshControl={<RefreshControl refreshing={loading} onRefresh={fetchPosts} />}
        ListFooterComponent={
          loading ? <ActivityIndicator size="large" /> : !hasMore ? <Text style={styles.noMore}>No more posts</Text> : null
        }
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 10, backgroundColor: "#fff" },
  header: { fontSize: 20, fontWeight: "bold", marginBottom: 10 },
  postCard: { backgroundColor: "#f9f9f9", padding: 15, borderRadius: 8, marginVertical: 5 },
  postBody: { fontSize: 16 },
  noMore: { textAlign: "center", marginVertical: 10 },
});
```

#### Create Post

Create **app/(protected)/createPost.tsx**:

```tsx
// app/(protected)/createPost.tsx
import React, { useState } from "react";
import { View, TextInput, Button, Image, Alert, StyleSheet, Text, TouchableOpacity, ActivityIndicator } from "react-native";
import * as ImagePicker from "expo-image-picker";
import { supabase } from "../../lib/supabaseClient";
import { useRouter } from "expo-router";
import { useAuth } from "../context/AuthProvider";

export default function CreatePostScreen() {
  const { user } = useAuth();
  const router = useRouter();
  const [body, setBody] = useState("");
  const [image, setImage] = useState<string | null>(null);
  const [uploading, setUploading] = useState<boolean>(false);

  const pickImage = async () => {
    const permissionResult = await ImagePicker.requestMediaLibraryPermissionsAsync();
    if (!permissionResult.granted) {
      Alert.alert("Permission required", "Permission to access media library is required!");
      return;
    }
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      quality: 0.7,
    });
    if (!result.cancelled) {
      setImage(result.uri);
    }
  };

  const uploadImage = async (uri: string): Promise<string | null> => {
    try {
      setUploading(true);
      const response = await fetch(uri);
      const blob = await response.blob();
      const fileExt = uri.split(".").pop();
      const fileName = `${Date.now()}.${fileExt}`;
      const filePath = `post_images/${fileName}`;
      const { error: uploadError } = await supabase.storage
        .from("uploads")
        .upload(filePath, blob, { upsert: false });
      if (uploadError) throw uploadError;
      const { publicURL } = supabase.storage.from("uploads").getPublicUrl(filePath);
      return publicURL;
    } catch (error) {
      console.error("Upload image error:", error);
      Alert.alert("Error", "Could not upload image");
      return null;
    } finally {
      setUploading(false);
    }
  };

  const handlePost = async () => {
    if (!body.trim() && !image) {
      Alert.alert("Error", "Please add text or select an image");
      return;
    }
    let fileUrl = null;
    if (image) {
      fileUrl = await uploadImage(image);
      if (!fileUrl) return;
    }
    const { error } = await supabase.from("posts").insert([{ user_id: user.id, body, file: fileUrl }]);
    if (error) {
      console.error("Error creating post:", error);
      Alert.alert("Error", error.message);
    } else {
      Alert.alert("Success", "Post created!");
      router.push("/(protected)/home");
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Create Post</Text>
      <TextInput
        style={styles.input}
        placeholder="What's on your mind?"
        value={body}
        onChangeText={setBody}
        multiline
      />
      <TouchableOpacity style={styles.imagePicker} onPress={pickImage}>
        <Text style={styles.imagePickerText}>Pick an Image</Text>
      </TouchableOpacity>
      {image && <Image source={{ uri: image }} style={styles.previewImage} />}
      {uploading ? (
        <ActivityIndicator size="large" />
      ) : (
        <Button title="Post" onPress={handlePost} />
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, backgroundColor: "#fff" },
  title: { fontSize: 24, fontWeight: "bold", marginBottom: 20, textAlign: "center" },
  input: { height: 100, borderWidth: 1, borderColor: "#ccc", padding: 10, marginBottom: 15, textAlignVertical: "top" },
  imagePicker: { padding: 10, backgroundColor: "#eee", alignItems: "center", marginBottom: 15 },
  imagePickerText: { color: "#333" },
  previewImage: { width: "100%", height: 200, marginBottom: 15, borderRadius: 8 },
});
```

### 7.2 Chat Functionality

Create **app/(protected)/chat.tsx**:

```tsx
// app/(protected)/chat.tsx
import React, { useEffect, useState, useRef } from "react";
import { View, FlatList, TextInput, Button, Text, StyleSheet, ActivityIndicator } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";

export default function ChatScreen() {
  const { user } = useAuth();
  const [messages, setMessages] = useState<any[]>([]);
  const [newMessage, setNewMessage] = useState("");
  const [loading, setLoading] = useState(false);
  const flatListRef = useRef<FlatList>(null);

  const fetchMessages = async () => {
    setLoading(true);
    const { data, error } = await supabase
      .from("chat_messages")
      .select(`*, user:users(id, name, image)`)
      .order("created_at", { ascending: true });
    if (error) console.error("Fetch chat error:", error);
    else setMessages(data);
    setLoading(false);
  };

  const sendMessage = async () => {
    if (!newMessage.trim()) return;
    const { error } = await supabase.from("chat_messages").insert([{ user_id: user.id, message: newMessage }]);
    if (error) {
      console.error("Send message error:", error);
    } else {
      setNewMessage("");
    }
  };

  useEffect(() => {
    fetchMessages();
    const chatChannel = supabase
      .channel("chat")
      .on(
        "postgres_changes",
        { event: "INSERT", schema: "public", table: "chat_messages" },
        (payload) => {
          setMessages((prev) => [...prev, payload.new]);
          flatListRef.current?.scrollToEnd({ animated: true });
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(chatChannel);
    };
  }, []);

  const renderMessage = ({ item }: { item: any }) => (
    <View style={[styles.messageContainer, item.user_id === user.id ? styles.myMessage : styles.otherMessage]}>
      <Text style={styles.messageText}>{item.message}</Text>
      <Text style={styles.messageTime}>{new Date(item.created_at).toLocaleTimeString()}</Text>
    </View>
  );

  return (
    <View style={styles.container}>
      {loading ? (
        <ActivityIndicator size="large" />
      ) : (
        <FlatList
          ref={flatListRef}
          data={messages}
          keyExtractor={(item) => String(item.id)}
          renderItem={renderMessage}
          style={styles.messageList}
        />
      )}
      <View style={styles.inputContainer}>
        <TextInput
          style={styles.input}
          placeholder="Type your message..."
          value={newMessage}
          onChangeText={setNewMessage}
        />
        <Button title="Send" onPress={sendMessage} />
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: "#fff" },
  messageList: { flex: 1, padding: 10 },
  messageContainer: { marginVertical: 5, padding: 10, borderRadius: 8, maxWidth: "80%" },
  myMessage: { alignSelf: "flex-end", backgroundColor: "#DCF8C6" },
  otherMessage: { alignSelf: "flex-start", backgroundColor: "#eee" },
  messageText: { fontSize: 16 },
  messageTime: { fontSize: 10, color: "#555", alignSelf: "flex-end", marginTop: 5 },
  inputContainer: { flexDirection: "row", padding: 10, borderTopWidth: 1, borderColor: "#ccc" },
  input: { flex: 1, height: 40, borderWidth: 1, borderColor: "#ccc", paddingHorizontal: 10, marginRight: 10 },
});
```

---

## 8. Admin Dashboard

Create **app/(admin)/dashboard.tsx**:

```tsx
// app/(admin)/dashboard.tsx
import React, { useEffect, useState } from "react";
import { View, Text, FlatList, ActivityIndicator, StyleSheet, Button } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useRouter } from "expo-router";

export default function AdminDashboard() {
  const [users, setUsers] = useState<any[]>([]);
  const [posts, setPosts] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(false);
  const router = useRouter();

  const fetchDashboardData = async () => {
    setLoading(true);
    const { data: usersData, error: usersError } = await supabase.from("users").select("*");
    if (usersError) console.error("Users fetch error:", usersError);
    else setUsers(usersData || []);

    const { data: postsData, error: postsError } = await supabase.from("posts").select("*");
    if (postsError) console.error("Posts fetch error:", postsError);
    else setPosts(postsData || []);

    setLoading(false);
  };

  useEffect(() => {
    fetchDashboardData();
  }, []);

  if (loading)
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Admin Dashboard</Text>
      <Text style={styles.subtitle}>Users ({users.length})</Text>
      <FlatList
        data={users}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <Text style={styles.itemText}>
            {item.name} - {item.email} (Role: {item.role})
          </Text>
        )}
      />
      <Text style={styles.subtitle}>Posts ({posts.length})</Text>
      <FlatList
        data={posts}
        keyExtractor={(item) => String(item.id)}
        renderItem={({ item }) => (
          <Text style={styles.itemText}>Post #{item.id}: {item.body.slice(0, 30)}...</Text>
        )}
      />
      <Button title="Back to Home" onPress={() => router.replace("/(protected)/home")} />
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, backgroundColor: "#fff" },
  center: { flex: 1, justifyContent: "center", alignItems: "center" },
  title: { fontSize: 26, fontWeight: "bold", marginBottom: 20 },
  subtitle: { fontSize: 20, marginVertical: 10 },
  itemText: { fontSize: 16, marginVertical: 4 },
});
```

---

## 9. Root Route – app/index.tsx

To ensure that when a user first visits your app the correct redirection occurs (to login if not authenticated or to home if authenticated), create an **app/index.tsx** file:

```tsx
// app/index.tsx
import { useEffect } from "react";
import { useRouter } from "expo-router";
import { useAuth } from "./context/AuthProvider";
import { ActivityIndicator, View, StyleSheet } from "react-native";

export default function Index() {
  const { user, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading) {
      if (user) {
        router.replace("/(protected)/home");
      } else {
        router.replace("/(auth)/login");
      }
    }
  }, [user, loading, router]);

  return (
    <View style={styles.container}>
      <ActivityIndicator size="large" />
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, justifyContent: "center", alignItems: "center" },
});
```

This file is crucial: it serves as your landing page and immediately redirects based on the authentication state.

---

## 10. Automated Setup Bash Script

Below is a complete shell script that bootstraps your project. (Note: All file paths that contain parentheses are wrapped in quotes to avoid shell syntax errors.) Save this as `setup.sh` in your repository’s root, make it executable, and run it.

```bash
#!/bin/bash
# setup.sh
# This script bootstraps the ScriptHammer Expo project.
# It creates the project, removes default files, installs dependencies,
# creates the folder structure, and writes all required files.
# Run this script from the root of your repository.

set -e

echo "Creating new Expo project: ScriptHammer"
npx create-expo-app ScriptHammer

cd ScriptHammer

echo "Resetting project..."
npm run reset-project

echo "Removing default files..."
rm -f app/index.tsx
rm -f app/_layout.tsx
rm -rf app-example

echo "Installing dependencies..."
npm install @supabase/supabase-js expo-router expo-image-picker

echo "Creating folder structure..."
mkdir -p "app/(auth)"
mkdir -p "app/(protected)"
mkdir -p "app/(admin)"
mkdir -p app/context
mkdir -p lib

echo "Updating app.json with extra field"
cat > app.json <<'EOF'
{
  "expo": {
    "name": "ScriptHammer",
    "slug": "ScriptHammer",
    "version": "1.0.0",
    "extra": {
      "EXPO_PUBLIC_SUPABASE_URL": "https://judtlzmkvugqbgmgxgfv.supabase.co",
      "EXPO_PUBLIC_SUPABASE_ANON_KEY": "YOUR_SUPABASE_ANON_KEY_HERE"
    },
    "orientation": "portrait",
    "icon": "./assets/images/icon.png",
    "scheme": "myapp",
    "userInterfaceStyle": "automatic",
    "newArchEnabled": true,
    "ios": {
      "supportsTablet": true
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/images/adaptive-icon.png",
        "backgroundColor": "#ffffff"
      }
    },
    "web": {
      "bundler": "metro",
      "output": "static",
      "favicon": "./assets/images/favicon.png"
    },
    "plugins": [
      "expo-router",
      [
        "expo-splash-screen",
        {
          "image": "./assets/images/splash-icon.png",
          "imageWidth": 200,
          "resizeMode": "contain",
          "backgroundColor": "#ffffff"
        }
      ]
    ],
    "experiments": {
      "typedRoutes": true
    }
  }
}
EOF

echo "Creating file: app/index.tsx"
cat > app/index.tsx <<'EOF'
import { useEffect } from "react";
import { useRouter } from "expo-router";
import { useAuth } from "./context/AuthProvider";
import { ActivityIndicator, View, StyleSheet } from "react-native";

export default function Index() {
  const { user, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading) {
      if (user) {
        router.replace("/(protected)/home");
      } else {
        router.replace("/(auth)/login");
      }
    }
  }, [user, loading, router]);

  return (
    <View style={styles.container}>
      <ActivityIndicator size="large" />
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, justifyContent: "center", alignItems: "center" },
});
EOF

echo "Creating file: app/_layout.tsx"
cat > app/_layout.tsx <<'EOF'
import React from "react";
import { Slot } from "expo-router";
import { AuthProvider } from "./context/AuthProvider";

export default function RootLayout() {
  return (
    <AuthProvider>
      <Slot />
    </AuthProvider>
  );
}
EOF

echo "Creating file: app/context/AuthProvider.tsx"
cat > app/context/AuthProvider.tsx <<'EOF'
import React, { createContext, useContext, useState, useEffect } from "react";
import { supabase } from "../../lib/supabaseClient";

interface AuthContextProps {
  user: any;
  loading: boolean;
  setUser: (user: any) => void;
}

const AuthContext = createContext<AuthContextProps | undefined>(undefined);

export const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  const [user, setUser] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);

  useEffect(() => {
    async function getSession() {
      const { data: { session } } = await supabase.auth.getSession();
      setUser(session?.user ?? null);
      setLoading(false);
    }
    getSession();

    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  return (
    <AuthContext.Provider value={{ user, loading, setUser }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error("useAuth must be used within an AuthProvider");
  return context;
};

export default AuthProvider;
EOF

echo "Creating file: lib/supabaseClient.ts"
cat > lib/supabaseClient.ts <<'EOF'
import { createClient } from "@supabase/supabase-js";
import Constants from "expo-constants";

const extras = Constants.manifest?.extra || Constants.expoConfig?.extra || {};
const { EXPO_PUBLIC_SUPABASE_URL, EXPO_PUBLIC_SUPABASE_ANON_KEY } = extras;

if (!EXPO_PUBLIC_SUPABASE_URL || !EXPO_PUBLIC_SUPABASE_ANON_KEY) {
  throw new Error("Missing Supabase environment variables. Please set EXPO_PUBLIC_SUPABASE_URL and EXPO_PUBLIC_SUPABASE_ANON_KEY in your app.json extra field.");
}

export const supabase = createClient(EXPO_PUBLIC_SUPABASE_URL, EXPO_PUBLIC_SUPABASE_ANON_KEY);
EOF

echo "Creating file: app/(protected)/_layout.tsx"
cat > "app/(protected)/_layout.tsx" <<'EOF'
import React, { useEffect } from "react";
import { View, ActivityIndicator, StyleSheet } from "react-native";
import { useRouter, useSegments } from "expo-router";
import { useAuth } from "../context/AuthProvider";

export default function ProtectedLayout({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const segments = useSegments();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user && segments[0] === "(protected)") {
      router.replace("/(auth)/login");
    }
  }, [user, loading, segments, router]);

  if (loading || (!user && segments[0] === "(protected)")) {
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );
  }
  return <>{children}</>;
}

const styles = StyleSheet.create({
  center: { flex: 1, justifyContent: "center", alignItems: "center" },
});
EOF

echo "Creating file: app/(admin)/_layout.tsx"
cat > "app/(admin)/_layout.tsx" <<'EOF'
import React, { useEffect } from "react";
import { View, ActivityIndicator, StyleSheet } from "react-native";
import { useRouter, useSegments } from "expo-router";
import { useAuth } from "../context/AuthProvider";

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const segments = useSegments();
  const router = useRouter();

  useEffect(() => {
    if (!loading && user && user.app_metadata?.role !== "admin") {
      router.replace("/(protected)/home");
    }
  }, [user, loading, segments, router]);

  if (loading || (user && user.app_metadata?.role !== "admin")) {
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );
  }
  return <>{children}</>;
}

const styles = StyleSheet.create({
  center: { flex: 1, justifyContent: "center", alignItems: "center" },
});
EOF

echo "Creating file: app/(auth)/login.tsx"
cat > "app/(auth)/login.tsx" <<'EOF'
import React, { useState } from "react";
import { View, TextInput, Button, ActivityIndicator, StyleSheet, Text } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";
import { Link, useRouter } from "expo-router";

export default function LoginScreen() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [errorMsg, setErrorMsg] = useState("");
  const [submitting, setSubmitting] = useState(false);
  const { setUser } = useAuth();
  const router = useRouter();

  const handleLogin = async () => {
    setErrorMsg("");
    if (!email || !password) {
      setErrorMsg("Please fill all fields.");
      return;
    }
    setSubmitting(true);
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    setSubmitting(false);
    if (error) {
      setErrorMsg(`Login Error: ${error.message}`);
    } else {
      setUser(data.session?.user);
      router.replace("/(protected)/home");
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Login</Text>
      <TextInput placeholder="Email" value={email} onChangeText={setEmail} style={styles.input} autoCapitalize="none" />
      <TextInput placeholder="Password" value={password} onChangeText={setPassword} secureTextEntry style={styles.input} />
      {submitting ? <ActivityIndicator size="large" /> : <Button title="Login" onPress={handleLogin} />}
      {errorMsg ? <Text style={styles.errorText}>{errorMsg}</Text> : null}
      <Link href="/(auth)/signup" style={styles.link}>
        Don't have an account? Sign Up
      </Link>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, justifyContent: "center" },
  title: { fontSize: 24, marginBottom: 20, textAlign: "center" },
  input: { height: 40, borderWidth: 1, borderColor: "#ccc", marginBottom: 15, paddingHorizontal: 10 },
  link: { marginTop: 20, textAlign: "center", color: "blue" },
  errorText: { color: "red", textAlign: "center", marginTop: 10 },
});
EOF

echo "Creating file: app/(auth)/signup.tsx"
cat > "app/(auth)/signup.tsx" <<'EOF'
import React, { useState } from "react";
import { View, TextInput, Button, ActivityIndicator, StyleSheet, Text } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";
import { Link, useRouter } from "expo-router";

export default function SignupScreen() {
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [errorMsg, setErrorMsg] = useState("");
  const [submitting, setSubmitting] = useState(false);
  const { setUser } = useAuth();
  const router = useRouter();

  const handleSignup = async () => {
    setErrorMsg("");
    if (!name || !email || !password) {
      setErrorMsg("Please fill all fields.");
      return;
    }
    setSubmitting(true);
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: { data: { name } }
    });
    setSubmitting(false);
    if (error) {
      setErrorMsg(`Signup Error: ${error.message}`);
    } else {
      setUser(data.session?.user);
      router.replace("/(protected)/home");
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Sign Up</Text>
      <TextInput placeholder="Name" value={name} onChangeText={setName} style={styles.input} />
      <TextInput placeholder="Email" value={email} onChangeText={setEmail} style={styles.input} autoCapitalize="none" />
      <TextInput placeholder="Password" value={password} onChangeText={setPassword} secureTextEntry style={styles.input} />
      {submitting ? <ActivityIndicator size="large" /> : <Button title="Sign Up" onPress={handleSignup} />}
      {errorMsg ? <Text style={styles.errorText}>{errorMsg}</Text> : null}
      <Link href="/(auth)/login" style={styles.link}>
        Already have an account? Login
      </Link>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, justifyContent: "center" },
  title: { fontSize: 24, marginBottom: 20, textAlign: "center" },
  input: { height: 40, borderWidth: 1, borderColor: "#ccc", marginBottom: 15, paddingHorizontal: 10 },
  link: { marginTop: 20, textAlign: "center", color: "blue" },
  errorText: { color: "red", textAlign: "center", marginTop: 10 },
});
EOF

echo "Creating file: app/(protected)/home.tsx"
cat > "app/(protected)/home.tsx" <<'EOF'
import React, { useEffect, useState } from "react";
import { View, Text, FlatList, ActivityIndicator, StyleSheet, RefreshControl } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";
import { useRouter } from "expo-router";

export default function HomeScreen() {
  const { user } = useAuth();
  const [posts, setPosts] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(false);
  const [limit, setLimit] = useState<number>(10);
  const [hasMore, setHasMore] = useState<boolean>(true);
  const router = useRouter();

  const fetchPosts = async () => {
    setLoading(true);
    const { data, error } = await supabase
      .from("posts")
      .select(`*, user:users(id, name, image)`)
      .order("created_at", { ascending: false })
      .limit(limit);
    if (error) {
      console.error("Error fetching posts:", error);
    } else {
      setPosts(data);
      if (data.length < limit) setHasMore(false);
    }
    setLoading(false);
  };

  useEffect(() => {
    fetchPosts();
  }, [limit]);

  useEffect(() => {
    const postChannel = supabase
      .channel("posts")
      .on(
        "postgres_changes",
        { event: "INSERT", schema: "public", table: "posts" },
        (payload) => {
          setPosts((prev) => [payload.new, ...prev]);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(postChannel);
    };
  }, []);

  const loadMore = () => {
    if (hasMore && !loading) {
      setLimit(limit + 10);
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.header}>Welcome, {user?.email}</Text>
      <FlatList
        data={posts}
        keyExtractor={(item) => String(item.id)}
        renderItem={({ item }) => (
          <View style={styles.postCard}>
            <Text style={styles.postBody}>{item.body}</Text>
          </View>
        )}
        onEndReached={loadMore}
        onEndReachedThreshold={0.5}
        refreshControl={<RefreshControl refreshing={loading} onRefresh={fetchPosts} />}
        ListFooterComponent={
          loading ? <ActivityIndicator size="large" /> : !hasMore ? <Text style={styles.noMore}>No more posts</Text> : null
        }
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 10, backgroundColor: "#fff" },
  header: { fontSize: 20, fontWeight: "bold", marginBottom: 10 },
  postCard: { backgroundColor: "#f9f9f9", padding: 15, borderRadius: 8, marginVertical: 5 },
  postBody: { fontSize: 16 },
  noMore: { textAlign: "center", marginVertical: 10 },
});
EOF

echo "Creating file: app/(protected)/createPost.tsx"
cat > "app/(protected)/createPost.tsx" <<'EOF'
import React, { useState } from "react";
import { View, TextInput, Button, Image, Alert, StyleSheet, Text, TouchableOpacity, ActivityIndicator } from "react-native";
import * as ImagePicker from "expo-image-picker";
import { supabase } from "../../lib/supabaseClient";
import { useRouter } from "expo-router";
import { useAuth } from "../context/AuthProvider";

export default function CreatePostScreen() {
  const { user } = useAuth();
  const router = useRouter();
  const [body, setBody] = useState("");
  const [image, setImage] = useState<string | null>(null);
  const [uploading, setUploading] = useState<boolean>(false);

  const pickImage = async () => {
    const permissionResult = await ImagePicker.requestMediaLibraryPermissionsAsync();
    if (!permissionResult.granted) {
      Alert.alert("Permission required", "Permission to access media library is required!");
      return;
    }
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      quality: 0.7,
    });
    if (!result.cancelled) {
      setImage(result.uri);
    }
  };

  const uploadImage = async (uri: string): Promise<string | null> => {
    try {
      setUploading(true);
      const response = await fetch(uri);
      const blob = await response.blob();
      const fileExt = uri.split(".").pop();
      const fileName = `${Date.now()}.${fileExt}`;
      const filePath = `post_images/${fileName}`;
      const { error: uploadError } = await supabase.storage
        .from("uploads")
        .upload(filePath, blob, { upsert: false });
      if (uploadError) throw uploadError;
      const { publicURL } = supabase.storage.from("uploads").getPublicUrl(filePath);
      return publicURL;
    } catch (error) {
      console.error("Upload image error:", error);
      Alert.alert("Error", "Could not upload image");
      return null;
    } finally {
      setUploading(false);
    }
  };

  const handlePost = async () => {
    if (!body.trim() && !image) {
      Alert.alert("Error", "Please add text or select an image");
      return;
    }
    let fileUrl = null;
    if (image) {
      fileUrl = await uploadImage(image);
      if (!fileUrl) return;
    }
    const { error } = await supabase.from("posts").insert([{ user_id: user.id, body, file: fileUrl }]);
    if (error) {
      console.error("Error creating post:", error);
      Alert.alert("Error", error.message);
    } else {
      Alert.alert("Success", "Post created!");
      router.push("/(protected)/home");
    }
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Create Post</Text>
      <TextInput
        style={styles.input}
        placeholder="What's on your mind?"
        value={body}
        onChangeText={setBody}
        multiline
      />
      <TouchableOpacity style={styles.imagePicker} onPress={pickImage}>
        <Text style={styles.imagePickerText}>Pick an Image</Text>
      </TouchableOpacity>
      {image && <Image source={{ uri: image }} style={styles.previewImage} />}
      {uploading ? (
        <ActivityIndicator size="large" />
      ) : (
        <Button title="Post" onPress={handlePost} />
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, backgroundColor: "#fff" },
  title: { fontSize: 24, fontWeight: "bold", marginBottom: 20, textAlign: "center" },
  input: { height: 100, borderWidth: 1, borderColor: "#ccc", padding: 10, marginBottom: 15, textAlignVertical: "top" },
  imagePicker: { padding: 10, backgroundColor: "#eee", alignItems: "center", marginBottom: 15 },
  imagePickerText: { color: "#333" },
  previewImage: { width: "100%", height: 200, marginBottom: 15, borderRadius: 8 },
});
EOF

echo "Creating file: app/(protected)/chat.tsx"
cat > "app/(protected)/chat.tsx" <<'EOF'
import React, { useEffect, useState, useRef } from "react";
import { View, FlatList, TextInput, Button, Text, StyleSheet, ActivityIndicator } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useAuth } from "../context/AuthProvider";

export default function ChatScreen() {
  const { user } = useAuth();
  const [messages, setMessages] = useState<any[]>([]);
  const [newMessage, setNewMessage] = useState("");
  const [loading, setLoading] = useState(false);
  const flatListRef = useRef<FlatList>(null);

  const fetchMessages = async () => {
    setLoading(true);
    const { data, error } = await supabase
      .from("chat_messages")
      .select(`*, user:users(id, name, image)`)
      .order("created_at", { ascending: true });
    if (error) console.error("Fetch chat error:", error);
    else setMessages(data);
    setLoading(false);
  };

  const sendMessage = async () => {
    if (!newMessage.trim()) return;
    const { error } = await supabase.from("chat_messages").insert([{ user_id: user.id, message: newMessage }]);
    if (error) {
      console.error("Send message error:", error);
    } else {
      setNewMessage("");
    }
  };

  useEffect(() => {
    fetchMessages();
    const chatChannel = supabase
      .channel("chat")
      .on(
        "postgres_changes",
        { event: "INSERT", schema: "public", table: "chat_messages" },
        (payload) => {
          setMessages((prev) => [...prev, payload.new]);
          flatListRef.current?.scrollToEnd({ animated: true });
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(chatChannel);
    };
  }, []);

  const renderMessage = ({ item }: { item: any }) => (
    <View style={[styles.messageContainer, item.user_id === user.id ? styles.myMessage : styles.otherMessage]}>
      <Text style={styles.messageText}>{item.message}</Text>
      <Text style={styles.messageTime}>{new Date(item.created_at).toLocaleTimeString()}</Text>
    </View>
  );

  return (
    <View style={styles.container}>
      {loading ? (
        <ActivityIndicator size="large" />
      ) : (
        <FlatList
          ref={flatListRef}
          data={messages}
          keyExtractor={(item) => String(item.id)}
          renderItem={renderMessage}
          style={styles.messageList}
        />
      )}
      <View style={styles.inputContainer}>
        <TextInput
          style={styles.input}
          placeholder="Type your message..."
          value={newMessage}
          onChangeText={setNewMessage}
        />
        <Button title="Send" onPress={sendMessage} />
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: "#fff" },
  messageList: { flex: 1, padding: 10 },
  messageContainer: { marginVertical: 5, padding: 10, borderRadius: 8, maxWidth: "80%" },
  myMessage: { alignSelf: "flex-end", backgroundColor: "#DCF8C6" },
  otherMessage: { alignSelf: "flex-start", backgroundColor: "#eee" },
  messageText: { fontSize: 16 },
  messageTime: { fontSize: 10, color: "#555", alignSelf: "flex-end", marginTop: 5 },
  inputContainer: { flexDirection: "row", padding: 10, borderTopWidth: 1, borderColor: "#ccc" },
  input: { flex: 1, height: 40, borderWidth: 1, borderColor: "#ccc", paddingHorizontal: 10, marginRight: 10 },
});
EOF

echo "Creating file: app/(admin)/dashboard.tsx"
cat > "app/(admin)/dashboard.tsx" <<'EOF'
import React, { useEffect, useState } from "react";
import { View, Text, FlatList, ActivityIndicator, StyleSheet, Button } from "react-native";
import { supabase } from "../../lib/supabaseClient";
import { useRouter } from "expo-router";

export default function AdminDashboard() {
  const [users, setUsers] = useState<any[]>([]);
  const [posts, setPosts] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(false);
  const router = useRouter();

  const fetchDashboardData = async () => {
    setLoading(true);
    const { data: usersData, error: usersError } = await supabase.from("users").select("*");
    if (usersError) console.error("Users fetch error:", usersError);
    else setUsers(usersData || []);

    const { data: postsData, error: postsError } = await supabase.from("posts").select("*");
    if (postsError) console.error("Posts fetch error:", postsError);
    else setPosts(postsData || []);

    setLoading(false);
  };

  useEffect(() => {
    fetchDashboardData();
  }, []);

  if (loading)
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Admin Dashboard</Text>
      <Text style={styles.subtitle}>Users ({users.length})</Text>
      <FlatList
        data={users}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <Text style={styles.itemText}>
            {item.name} - {item.email} (Role: {item.role})
          </Text>
        )}
      />
      <Text style={styles.subtitle}>Posts ({posts.length})</Text>
      <FlatList
        data={posts}
        keyExtractor={(item) => String(item.id)}
        renderItem={({ item }) => (
          <Text style={styles.itemText}>Post #{item.id}: {item.body.slice(0, 30)}...</Text>
        )}
      />
      <Button title="Back to Home" onPress={() => router.replace("/(protected)/home")} />
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20, backgroundColor: "#fff" },
  center: { flex: 1, justifyContent: "center", alignItems: "center" },
  title: { fontSize: 26, fontWeight: "bold", marginBottom: 20 },
  subtitle: { fontSize: 20, marginVertical: 10 },
  itemText: { fontSize: 16, marginVertical: 4 },
});
EOF

echo "Setup complete! To launch your project, run 'npm start' (or 'npx expo start') inside the ScriptHammer directory."
```

---

## 11. Final Notes & Next Steps

You now have a complete, fully functional framework that includes:

- **Supabase SQL Setup:**  
  - Tables for users (with a role), posts, comments, chat messages, and notifications with proper RLS policies.  
  - A trigger that automatically creates a user record on signup (assigning the first user as “admin”).

- **Expo Setup:**  
  - Environment variables provided via your out‑of‑the‑box `app.json`.  
  - A file‑system–based routing structure using Expo Router with protected (`(protected)`) and admin (`(admin)`) groups.  
  - An **app/index.tsx** file that immediately redirects based on the user's authentication state.  
  - The authentication context is stored in a `context` folder (without parentheses) so that module resolution works correctly.

- **Social Features:**  
  - A home feed with realtime updates.  
  - A dedicated Create Post screen (with image upload support via Expo ImagePicker and Supabase Storage).  
  - A Chat screen for realtime messaging.

- **Admin Dashboard:**  
  - An admin‑only route that displays statistics about users and posts.

- **Visual Feedback:**  
  - The Login and Signup screens now display error messages and a loading spinner so that users receive clear on‑screen feedback.

- **Automation:**  
  - A complete shell script (`setup.sh`) that bootstraps your project by creating the project, deleting default files, installing dependencies, and writing all required boilerplate files.

### To Bootstrap Your Project

1. Save the `setup.sh` script in your repository’s root.
2. Make it executable:

   ```bash
   chmod +x setup.sh
   ```

3. Run the script:

   ```bash
   ./setup.sh
   ```

4. Once the script completes, change directory into **ScriptHammer** and start your project:

   ```bash
   cd ScriptHammer
   npm start
   ```

5. Verify that:
   - When no user is logged in, the **app/index.tsx** file automatically redirects to `/ (auth)/login`.
   - When a user is logged in, they are redirected to `/ (protected)/home`.

Happy coding—and enjoy building your full‑featured social network and admin dashboard with Expo SDK‑52 and Supabase!

---

*If you continue to experience issues with folder names containing parentheses, consider renaming the folders (for example, use `auth`, `protected`, and `admin` instead of `(auth)`, `(protected)`, and `(admin)`) and update the corresponding import paths accordingly.*
